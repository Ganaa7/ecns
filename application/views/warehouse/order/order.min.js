jQuery(document).ready(function(){jQuery("#grid").jqGrid({url:"/ecns/wm_ajax/order",datatype:"xml",mtype:"GET",colNames:["\u0417\u0430\u0445\u0438\u0430\u043b\u0433\u0430 \u2116","\u0417\u0430\u0445.\u041e\u0433\u043d\u043e\u043e","\u0425\u044d\u0441\u044d\u0433","\u0417\u0430\u0445\u0438\u0430\u043b\u0441\u0430\u043d","\u0411\u04af\u0440\u0442\u0433\u044d\u0433\u0434\u0441\u044d\u043d","\u0422\u044d\u043c\u0434\u044d\u0433\u043b\u044d\u043b","\u0422\u04e9\u043b\u04e9\u0432","\u0425\u0430\u0440\u0438\u0443\u0446\u0441\u0430\u043d",
"\u04ae\u0439\u043b\u0434\u044d\u043b","status_id"],colModel:[{name:"order_no",index:"order_no",width:30,align:"right"},{name:"order_date",index:"order_date",width:40,align:"center",searchoptions:{dataInit:function(el){$(el).datepicker({dateFormat:"yy-mm-dd"}).change(function(){$("#grid")[0].triggerToolbar()})}}},{name:"section",index:"section",width:70,stype:"select",searchoptions:{value:":\u0411\u04af\u0433\u0434;\u0425\u04af\u043d\u0438\u0439 \u043d\u04e9\u04e9\u0446 \u0437\u0430\u0445\u0438\u0440\u0433\u0430\u0430:\u0425\u04af\u043d\u0438\u0439 \u043d\u04e9\u04e9\u0446 \u0437\u0430\u0445\u0438\u0440\u0433\u0430\u0430;\u0418\u043d\u0436\u0435\u043d\u0435\u0440\u0438\u043d\u0433, \u0441\u0443\u0440\u0433\u0430\u043b\u0442:\u0418\u043d\u0436\u0435\u043d\u0435\u0440\u0438\u043d\u0433, \u0441\u0443\u0440\u0433\u0430\u043b\u0442;\u0425\u0430\u043d\u0433\u0430\u043c\u0436:\u0425\u0430\u043d\u0433\u0430\u043c\u0436;\u0410\u0410\u0427\u0423:\u0410\u0410\u0427\u0423;\u0425\u043e\u043b\u0431\u043e\u043e:\u0425\u043e\u043b\u0431\u043e\u043e;\u041d\u0430\u0432\u0438\u0433\u0430\u0446\u0438:\u041d\u0430\u0432\u0438\u0433\u0430\u0446\u0438;\u0410\u0436\u0438\u0433\u043b\u0430\u043b\u0442:\u0410\u0436\u0438\u0433\u043b\u0430\u043b\u0442;\u0413\u044d\u0440\u044d\u043b \u0441\u0443\u0443\u043b\u0442, \u0446\u0430\u0445\u0438\u043b\u0433\u0430\u0430\u043d:\u0413\u0421\u0426"}},
{name:"orderby",index:"orderby",width:40},{name:"registed_date",index:"registed_date",width:40,align:"center",searchoptions:{dataInit:function(el){$(el).datepicker({dateFormat:"yy-mm-dd"}).change(function(){$("#grid")[0].triggerToolbar()})}}},{name:"comment",index:"comment",width:100},{name:"status",index:"status",width:50},{name:"steward",index:"steward",width:50},{name:"role",index:"role",width:60,formatter:orderAction},{name:"status_id",index:"status_id",hidden:true}],pager:jQuery("#pager"),rowNum:15,
rowList:[10,20,30],sortname:"order_id",sortorder:"desc",viewrecords:true,caption:"\u0410\u0433\u0443\u0443\u043b\u0430\u0445\u044b\u043d \u0431\u04af\u0440\u0442\u0433\u044d\u043b",autowidth:true,height:"400",width:"100%",subGrid:true,subGridRowExpanded:function(subgrid_id,row_id){var subgrid_table_id;subgrid_table_id=subgrid_id+"_t";jQuery("#"+subgrid_id).html("<table id='"+subgrid_table_id+"' class='scroll'></table>");jQuery("#"+subgrid_table_id).jqGrid({url:"/ecns/wm_ajax/orderDtl?id="+row_id,
datatype:"xml",colNames:["#","\u0421\u044d\u043b\u0431\u044d\u0433, \u0411\u0430\u0440\u0430\u0430","\u0425\u044d\u043c\u0436\u0438\u0445 \u043d\u044d\u0433\u0436","\u0422\u043e\u043e \u0448\u0438\u0440\u0445\u044d\u0433","\u0428\u0430\u0430\u0440\u0434\u0430\u0445 \u04af\u043d\u0434\u044d\u0441\u043b\u044d\u043b"],colModel:[{name:"id",index:"id",width:80,key:true},{name:"spare",index:"spare",width:130},{name:"measure",index:"measure",width:80},{name:"qty",index:"qty",width:80,align:"right"},{name:"reason",
index:"reason",width:300}],height:"100%",width:800,rowNum:20,sortname:"id",sortorder:"asc"})}}).navGrid("#pager",{edit:false,add:false,del:false,multipleSearch:true});$("#grid").jqGrid("filterToolbar",{stringResult:true,searchOnEnter:false});function orderAction(cellvalue,options,rowObject){var url_action="";console.log(rowObject);if(cellvalue==="WENG"){if(rowObject.childNodes[9].textContent)return'<a href ="#" onclick="cancelOrder('+options.rowId+')">\u0422\u044d\u043c\u0434\u044d\u0433\u043b\u044d\u043b</a> | <a href = "#" onclick="deleteOrder('+
options.rowId+')">\u0423\u0441\u0442\u0433\u0430\u0445</a>| <a href = "/ecns/wm_report/printOrder/'+options.rowId+'">\u0425\u044d\u0432\u043b\u044d\u0445</a>'}else return'<a href = "/ecns/wm_report/printOrder/'+options.rowId+'">\u0425\u044d\u0432\u043b\u044d\u0445</a>'}$("#searchbtn").click(function(){jQuery("#grid").jqGrid("searchGrid",{sopt:["eq","ne","cn","bw","lt","gt","ew"]})});jQuery("#grid").jqGrid("navGrid","#grid",{del:false,add:false,edit:false},{},{},{},{multipleSearch:true});$("#search").click(function(){var spare=
$("#spare").val();if(spare===null||spare===""){alert("\u0421\u044d\u043b\u0431\u044d\u0433\u0438\u0439\u043d \u043d\u044d\u0440\u044d\u044d \u0431\u0438\u0447\u0438\u0436 \u0445\u0430\u0439\u043d\u0430 \u0443\u0443!");$("#grid").setGridParam({url:"/ecns/wm_ajax/order",datatype:"xml",sortname:"order_no",sortorder:"asc"}).trigger("reloadGrid")}else $("#grid").jqGrid("setGridParam",{url:"/ecns/wm_ajax/order?spare="+spare,page:1}).trigger("reloadGrid")});$("#regdate").datepicker({dateFormat:"yy-mm-dd"});
var comment,order_no=$("#orderno"),regdate=$("#regdate");$("#dialog_c").dialog({autoOpen:false,width:340,modal:true,buttons:[{text:"\u0425\u0430\u0434\u0433\u0430\u043b\u0430\u0445",click:function(){$.post("/ecns/wm_ajax/orderSet/register",{order_id:$("#order_id").val(),comment:$("#cancel_comment").val(),steward_id:$("#steward_id").val()}).done(function(data){$("#grid").jqGrid("setGridParam",{url:"/ecns/wm_ajax/order",page:1}).trigger("reloadGrid")});$("#cancel_comment").val("");$(this).dialog("close")}},
{text:"\u0411\u043e\u043b\u0438\u0445",click:function(){$(this).dialog("close")}}]});$("#dialog_r").dialog({autoOpen:false,width:340,modal:true,buttons:[{text:"\u0425\u0430\u0434\u0433\u0430\u043b\u0430\u0445",click:function(){if(order_no.val()===null||order_no.val()===""||regdate.val()===null||regdate.val()==="")alert("\u0417\u0430\u0445\u0438\u0430\u043b\u0433\u0438\u0439\u043d \u0434\u0443\u0433\u0430\u0430\u0440 \u044d\u0441\u0432\u044d\u043b \u041e\u0433\u043d\u043e\u043e \u0445\u043e\u043e\u0441\u043e\u043d \u0431\u0430\u0439\u043d\u0430. \u0423\u0442\u0433\u0443\u0443\u0434\u044b\u0433 \u043e\u0440\u0443\u0443\u043b\u043d\u0430 \u0443\u0443!");
else{$.post("/ecns/wm_ajax/orderSet/register",{order_id:$("#order_id").val(),order_no:order_no.val(),steward_id:$("#steward_id").val(),regdate:regdate.val()}).done(function(data){$("#grid").jqGrid("setGridParam",{url:"/ecns/wm_ajax/order",page:1}).trigger("reloadGrid");$.post("/ecns/wm_ajax/getorderNo",function(data){$("#orderno").val(data.order_no)})});$(this).dialog("close")}}},{text:"\u0411\u043e\u043b\u0438\u0445",click:function(){$(this).dialog("close")}}]});$("#dialog_d").dialog({autoOpen:false,
width:340,modal:true,buttons:[{text:"\u0425\u0430\u0434\u0433\u0430\u043b\u0430\u0445",click:function(){$.post("/ecns/wm_ajax/orderSet/cancel",{order_id:$("#order_id").val(),comment:$("#cancel_comment").val()}).done(function(data){$("#grid").jqGrid("setGridParam",{url:"/ecns/wm_ajax/order",page:1}).trigger("reloadGrid")});$("#cancel_comment").val("");$(this).dialog("close")}},{text:"\u0411\u043e\u043b\u0438\u0445",click:function(){$(this).dialog("close")}}]});$.post("/ecns/wm_ajax/getorderNo",function(data){$("#orderno").val(data.order_no)})});
function orderRegister(row_id){$("#order_id").val(row_id);$("#dialog_r").dialog("open")}function cancelOrder(row_id){$("#order_id").val(row_id);$("#dialog_c").dialog("open")}
function deleteOrder(row_id){$("#order_id").val(row_id);if(confirm("\u0422\u0430 \u044d\u043d\u044d \u0437\u0430\u0445\u0438\u0430\u043b\u0433\u0438\u0439\u0433 \u0443\u0441\u0442\u0433\u0430\u0445\u0434\u0430\u0430 \u0438\u0442\u0433\u044d\u043b\u0442\u044d\u0439 \u0431\u0430\u0439\u043d\u0430 \u0443\u0443!")==true)$.post("/ecns/wm_ajax/orderDelete",{order_id:row_id}).done(function(data){alert("\u2116"+data+" \u0434\u0443\u0433\u0430\u0430\u0440\u0442\u0430\u0439 \u0417\u0430\u0445\u0438\u0430\u043b\u0433\u044b\u0433 \u0430\u043c\u0436\u0438\u043b\u0442\u0442\u0430\u0439 \u0443\u0441\u0442\u0433\u0430\u043b\u0430\u0430!");
$("#grid").jqGrid("setGridParam",{url:"/ecns/wm_ajax/order",page:1}).trigger("reloadGrid")});else alert("\u0417\u0430\u0445\u0438\u0430\u043b\u0433\u0430 \u0443\u0441\u0442\u0433\u0430\u0445\u0430\u0434 \u0430\u043b\u0434\u0430\u0430 \u0433\u0430\u0440\u043b\u0430\u0430!")}function approveOrder(row_id){$.post("/ecns/wm_ajax/orderSet/approve",{order_id:row_id}).done(function(data){$("#grid").jqGrid("setGridParam",{url:"/ecns/wm_ajax/order",page:1}).trigger("reloadGrid")})};