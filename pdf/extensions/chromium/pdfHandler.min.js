"use strict";var VIEWER_URL=chrome.extension.getURL("content/web/viewer.html");function getViewerURL(a){return VIEWER_URL+"?file="+encodeURIComponent(a)}function isPdfDownloadable(b){if(b.url.indexOf("pdfjs.action=download")>=0){return true}if(b.type=="main_frame"){return false}var a=(b.responseHeaders&&getHeaderFromHeaders(b.responseHeaders,"content-disposition"));return(a&&/^attachment/i.test(a.value))}function getHeaderFromHeaders(b,d){for(var a=0;a<b.length;++a){var c=b[a];if(c.name.toLowerCase()===d){return c}}}function isPdfFile(a){var c=getHeaderFromHeaders(a.responseHeaders,"content-type");if(c){var b=c.value.toLowerCase().split(";",1)[0].trim();return(b==="application/pdf"||b==="application/octet-stream"&&a.url.toLowerCase().indexOf(".pdf")>0)}}function getHeadersWithContentDispositionAttachment(b){var c=b.responseHeaders;var a=getHeaderFromHeaders(c,"content-disposition");if(!a){a={name:"Content-Disposition"};c.push(a)}if(!/^attachment/i.test(a.value)){a.value="attachment"+a.value.replace(/^[^;]+/i,"");return{responseHeaders:c}}}chrome.webRequest.onHeadersReceived.addListener(function(b){if(b.method!=="GET"){return}if(!isPdfFile(b)){return}if(isPdfDownloadable(b)){return getHeadersWithContentDispositionAttachment(b)}var a=getViewerURL(b.url);if(b.frameId===0){chrome.tabs.update(b.tabId,{url:a});return{cancel:true}}else{chrome.webNavigation.onErrorOccurred.addListener(function c(d){if(d.tabId!==b.tabId||d.frameId!==b.frameId){return}chrome.webNavigation.onErrorOccurred.removeListener(c);chrome.tabs.executeScriptInFrame(b.tabId,{frameId:b.frameId,code:"location.href = "+JSON.stringify(a)+";"},function(e){if(!e){console.warn("Frame not found! Opening viewer in new tab...");chrome.tabs.create({url:a})}})},{url:[{urlEquals:b.url.split("#",1)[0]}]});return{responseHeaders:[{name:"X-Content-Type-Options",value:"nosniff"},{name:"X-Frame-Options",value:"deny"}]}}},{urls:["<all_urls>"],types:["main_frame","sub_frame"]},["blocking","responseHeaders"]);chrome.webRequest.onBeforeRequest.addListener(function(b){if(isPdfDownloadable(b)){return}var a=getViewerURL(b.url);return{redirectUrl:a}},{urls:["file://*/*.pdf","file://*/*.PDF"],types:["main_frame","sub_frame"]},["blocking"]);