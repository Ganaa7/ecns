"use strict";var Page=(function PageClosure(){var h=[0,0,612,792];function d(m,n,i,l,k,j){this.pdfManager=m;this.pageIndex=i;this.pageDict=l;this.xref=n;this.ref=k;this.fontCache=j;this.idCounters={obj:0};this.resourcesPromise=null}d.prototype={getPageProp:function g(i){return this.pageDict.get(i)},getInheritedPageProp:function e(i){var k=this.pageDict;var j=k.get(i);while(j===undefined){k=k.get("Parent");if(!k){break}j=k.get(i)}return j},get contentfunction(){return this.getPageProp("Contents")},get resourcesfunction(){var i=this.getInheritedPageProp("Resources");if(i===undefined){i=new Dict()}return shadow(this,"resources",i)},get mediaBoxfunction(){var i=this.getInheritedPageProp("MediaBox");if(!isArray(i)||i.length!==4){i=h}return shadow(this,"mediaBox",i)},get viewfunction(){var i=this.mediaBox;var j=this.getInheritedPageProp("CropBox");if(!isArray(j)||j.length!==4){return shadow(this,"view",i)}j=Util.intersect(j,i);if(!j){return shadow(this,"view",i)}return shadow(this,"view",j)},get annotationRefsfunction(){return shadow(this,"annotationRefs",this.getInheritedPageProp("Annots"))},get rotatefunction(){var i=this.getInheritedPageProp("Rotate")||0;if(i%90!==0){i=0}else{if(i>=360){i=i%360}else{if(i<0){i=((i%360)+360)%360}}}return shadow(this,"rotate",i)},getContentStream:function f(){var k=this.content;var m;if(isArray(k)){var l=this.xref;var j,p=k.length;var o=[];for(j=0;j<p;++j){o.push(l.fetchIfRef(k[j]))}m=new StreamsSequenceStream(o)}else{if(isStream(k)){m=k}else{m=new NullStream()}}return m},loadResources:function(j){if(!this.resourcesPromise){this.resourcesPromise=this.pdfManager.ensure(this,"resources")}var k=new LegacyPromise();this.resourcesPromise.then(function i(){var l=new ObjectLoader(this.resources.map,j,this.xref);l.load().then(function m(){k.resolve()})}.bind(this));return k},getOperatorList:function a(q,j){var r=this;var s=new LegacyPromise();function t(u){s.reject(u)}var n=new LegacyPromise();var o=this.pdfManager;var p=o.ensure(this,"getContentStream",[]);var k=this.loadResources(["ExtGState","ColorSpace","Pattern","Shading","XObject","Font"]);var m=new PartialEvaluator(o,this.xref,q,this.pageIndex,"p"+this.pageIndex+"_",this.idCounters,this.fontCache);var l=Promise.all([p,k],t);l.then(function(w){var u=w[0];var v=new OperatorList(j,q,r.pageIndex);q.send("StartRenderPage",{transparency:m.hasBlendModes(r.resources),pageIndex:r.pageIndex,intent:j});m.getOperatorList(u,r.resources,v);n.resolve(v)});var i=o.ensure(this,"annotations");Promise.all([n,i]).then(function(u){var w=u[0];var x=u[1];if(x.length===0){w.flush(true);s.resolve(w);return}var v=Annotation.appendToOperatorList(x,w,o,m,j);v.then(function(){w.flush(true);s.resolve(w)},t)},t);return s},extractTextContent:function c(){var p={on:function i(){},send:function o(){}};var q=this;var j=new LegacyPromise();var m=this.pdfManager;var n=m.ensure(this,"getContentStream",[]);var k=this.loadResources(["ExtGState","XObject","Font"]);var l=Promise.all([n,k]);l.then(function(s){var r=s[0];var u=new PartialEvaluator(m,q.xref,p,q.pageIndex,"p"+q.pageIndex+"_",q.idCounters,q.fontCache);var t=u.getTextContent(r,q.resources);j.resolve(t)});return j},getAnnotationsData:function b(){var l=this.annotations;var k=[];for(var j=0,m=l.length;j<m;++j){k.push(l[j].getData())}return k},get annotationsfunction(){var o=[];var l=(this.annotationRefs||[]);for(var k=0,p=l.length;k<p;++k){var m=l[k];var j=Annotation.fromRef(this.xref,m);if(j){o.push(j)}}return shadow(this,"annotations",o)}};return d})();var PDFDocument=(function PDFDocumentClosure(){function f(m,k,l){if(isStream(k)){i.call(this,m,k,l)}else{if(isArrayBuffer(k)){i.call(this,m,new Stream(k),l)}else{error("PDFDocument: Unknown argument type")}}}function i(l,n,k){assertWellFormed(n.length>0,"stream must have data");this.pdfManager=l;this.stream=n;var m=new XRef(this.stream,k,l);this.xref=m}function d(u,o,l,t){var s=u.pos;var m=u.end;var q=[];if(s+l>m){l=m-s}for(var k=0;k<l;++k){q.push(String.fromCharCode(u.getByte()))}var r=q.join("");u.pos=s;var p=t?r.lastIndexOf(o):r.indexOf(o);if(p==-1){return false}u.pos+=p;return true}var g={get entriesfunction(){return shadow(this,"entries",{Title:isString,Author:isString,Subject:isString,Keywords:isString,Creator:isString,Producer:isString,CreationDate:isString,ModDate:isString,Trapped:isName})}};f.prototype={parse:function c(m){this.setup(m);try{this.acroForm=this.catalog.catDict.get("AcroForm");if(this.acroForm){this.xfa=this.acroForm.get("XFA");var k=this.acroForm.get("Fields");if((!k||!isArray(k)||k.length===0)&&!this.xfa){this.acroForm=null}}}catch(l){info("Something wrong with AcroForm entry");this.acroForm=null}},get linearizationfunction(){var m=this.stream.length;var l=false;if(m){try{l=new Linearization(this.stream);if(l.length!=m){l=false}}catch(k){if(k instanceof MissingDataException){throw k}info("The linearization data is not available or unreadable PDF data is found");l=false}}return shadow(this,"linearization",l)},get startXReffunction(){var q=this.stream;var k=0;var n=this.linearization;if(n){q.reset();if(d(q,"endobj",1024)){k=q.pos+6}}else{var m=1024;var o=false,r=q.end;while(!o&&r>0){r-=m-"startxref".length;if(r<0){r=0}q.pos=r;o=d(q,"startxref",m,true)}if(o){q.skip(9);var l;do{l=q.getByte()}while(Lexer.isSpace(l));var p="";while(l>=32&&l<=57){p+=String.fromCharCode(l);l=q.getByte()}k=parseInt(p,10);if(isNaN(k)){k=0}}}return shadow(this,"startXRef",k)},get mainXRefEntriesOffsetfunction(){var k=0;var l=this.linearization;if(l){k=l.mainXRefEntriesOffset}return shadow(this,"mainXRefEntriesOffset",k)},checkHeader:function e(){var n=this.stream;n.reset();if(d(n,"%PDF-",1024)){n.moveStart();var l=12;var k="",m;while((m=n.getByte())>32){if(k.length>=l){break}k+=String.fromCharCode(m)}this.pdfFormatVersion=k.substring(5);return}},parseStartXRef:function h(){var k=this.startXRef;this.xref.setStartXRef(k)},setup:function b(k){this.xref.parse(k);this.catalog=new Catalog(this.pdfManager,this.xref)},get numPagesfunction(){var l=this.linearization;var k=l?l.numPages:this.catalog.numPages;return shadow(this,"numPages",k)},get documentInfofunction(){var k={PDFFormatVersion:this.pdfFormatVersion,IsAcroFormPresent:!!this.acroForm,IsXFAPresent:!!this.xfa};var p;try{p=this.xref.trailer.get("Info")}catch(n){info("The document information dictionary is invalid.")}if(p){var l=g.entries;for(var m in l){if(p.has(m)){var o=p.get(m);if(l[m](o)){k[m]=(typeof o!=="string"?o:stringToPDFString(o))}else{info('Bad value in document info for "'+m+'"')}}}}return shadow(this,"documentInfo",k)},get fingerprintfunction(){var o=this.xref,m,k="";if(o.trailer.has("ID")){m=stringToBytes(o.trailer.get("ID")[0])}else{m=calculateMD5(this.stream.bytes.subarray(0,100),0,100)}for(var l=0,p=m.length;l<p;l++){k+=m[l].toString(16)}return shadow(this,"fingerprint",k)},getPage:function j(k){return this.catalog.getPage(k)},cleanup:function a(){return this.catalog.cleanup()}};return f})();