function check_date(e){var t=new Date(current_date()),i=(e=new Date(e),e-t),a=Math.ceil(i/864e5);return a}function current_date(){var e=new Date,t=e.getDate(),i=e.getMonth()+1,a=e.getFullYear();return t<10&&(t="0"+t),i<10&&(i="0"+i),a+"-"+i+"-"+t}function set_type(){var e="";return e=":Бүгд;Даатгалын:Даатгалын;Гадаад байгууллагууд:Гадаад байгууллагууд;Хамтран ажиллах гэрээ:Хамтран ажиллах гэрээ;Түрээсийн гэрээ:Түрээсийн гэрээ;Худалдан авалтын гэрээ:Худалдан авалт;Цахилгаан эрчим хүч, түүнтэй холбоотой:Цахилгаан эрчим хүч;Захиргаа:Захиргаа;Давтамжийн зөвшөөрөл:Давтамжийн зөвшөөрөл;Радиолокаторын:Радиолокаторын;Бусад:Бусад",e}function archive_action(e,t,i){action_str="<div title='Дэлгэрэнгүй' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit'><a target='_blank' href='"+base_url+"/pdf/web/viewer.html?file=../../download/contract_archive_files/"+i.filename+"' class='ui-icon ui-icon-extlink'></a></div></div>";$("#action").serializeArray();return $("input.action").each(function(){switch($(this).val()){case"edit":action_str=action_str+"<div title='Засах' style='float:left;cursor:pointer;' class='ui-pg-div ui-icon-plus'><span onclick='init_edit("+i.trainer_id+")' class='ui-icon ui-icon-wrench'></span></div></div>";break;case"delete":action_str=action_str+"<div title='Устгах' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit'><span onclick='_delete("+i.trainer_id+")' target ="+t.log_num+" class='ui-icon ui-icon-trash'></span></div></div>"}}),action_str}function t_action(e,t,i){action_str="<div title='Дэлгэрэнгүй' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit'><a target='_blank' href='"+base_url+"/pdf/web/viewer.html?file=../../download/contract_files/"+i.filename+"' class='ui-icon ui-icon-extlink'></a></div></div>";$("#action").serializeArray();return $("input.action").each(function(){switch($(this).val()){case"edit":action_str=action_str+"<div title='Засах' style='float:left;cursor:pointer;' class='ui-pg-div ui-icon-plus'><span onclick='init_edit("+i.id+")' class='ui-icon ui-icon-wrench'></span></div></div>";break;case"delete":action_str=action_str+"<div title='Устгах' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit'><span onclick='_delete("+i.id+")' target ="+t.log_num+" class='ui-icon ui-icon-trash'></span></div></div>";break;default:action_str=action_str+"<div title='Архив' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit'><span onclick='outservice("+i.id+")' class='ui-icon ui-icon-cancel'></span></div></div>"}}),action_str}function init_view(e){window.open(base_url+"/pdf/web/viewer.html?file=../../download/contract_files/"+e+"'","_blank")}function init_edit(e){window.location.href=base_url+"/contract/settings/edit/"+e}function view_link(e,t,i){return"<a target='_blank' href='"+base_url+"/pdf/web/viewer.html?file=../../download/contract_files/"+i.filename+"' >"+e+"</a>"}function archive_link(e,t,i){return"<a target='_blank' href='"+base_url+"/pdf/web/viewer.html?file=../../download/contract_archive_files/"+i.filename+"' >"+e+"</a>"}function _delete(e){var t={id:e},i=$("#grid").getRowData(e);window.confirm("Та '"+i.fullname+"' ИТА-ын бүртгэлийг устгахдаа итгэлтэй байна уу?")&&$.ajax({type:"POST",url:base_url+"/training/index/delete/",data:t,dataType:"json",success:function(e){"success"==e.status&&(showMessage(e.message,"success"),$("#grid").trigger("reloadGrid"))}})}function showMessage(e,t){$("p#notification").length||$("#nav-bar").prepend('<p id="notification"></p>');var i=$("p#notification");i.hide(),i.removeClass(),i.addClass(t),i.html(e),i.fadeIn("fast",function(){i.delay(3e3).fadeOut()})}function outservice(e){if(1!=confirm(' Энэ гэрээг "Ашиглалтаас хасахдаа" итгэлтэй байна уу?'))return 0;$.ajax({type:"POST",url:base_url+"/contract/index/outservice/"+e,data:{id:e},dataType:"json",success:function(e){e.success?(showMessage(e.message,"success"),reload()):(showMessage(e.message,"error"),reload())}})}$(function(){sel_str=set_type(),contract=$("#contract"),contract.dialog({autoOpen:!1,width:550,resizable:!1,modal:!0,position:["center",100],close:function(){$('input[type="text"], input[type="hidden"], select, textarea',page_open).val(""),$(this).dialog("close")}}),jQuery("#grid").jqGrid({url:base_url+"/contract/index/grid",datatype:"json",mtype:"GET",height:"500",width:"1260",colNames:["#","Гэрээний №","Төрөл","Гэрээ","Талууд","filename","Батлагдсан/t","Дуусах/t","Төлбөрийн баримт","Үйлдэл"],colModel:[{name:"id",index:"id",search:!1,width:20},{name:"contract_no",index:"contract_no",width:40,align:"center"},{name:"category",index:"category",width:70,align:"left",stype:"select",searchoptions:{value:sel_str}},{name:"title",index:"title",width:220,align:"left",formatter:view_link},{name:"sides",index:"sides",width:150,align:"right"},{name:"filename",index:"filename",hidden:!0},{name:"approved",index:"approved",width:40,align:"center",searchoptions:{dataInit:function(e){$(e).datepicker({dateFormat:"yy-mm-dd"}).change(function(){$("#grid")[0].triggerToolbar()})}}},{name:"expireddate",index:"expireddate",width:40,align:"center",searchoptions:{dataInit:function(e){$(e).datepicker({dateFormat:"yy-mm-dd"}).change(function(){$("#grid")[0].triggerToolbar()})}}},{name:"invoice_file",index:"invoice_file",width:65},{name:"action",index:"action",width:40,align:"center",sortable:!1,search:!1,formatter:t_action}],jsonReader:{page:"page",total:"total",records:"records",root:"rows",repeatitems:!1,id:"id"},rowNum:20,rowList:[10,20,30],pager:"#pager",sortname:"category",viewrecords:!0,sortorder:"asc",caption:".::+ Гэрээний бүртгэл +::.",loadComplete:function(){for(var e=$(this).jqGrid("getDataIDs"),t=0;t<e.length;t++){var i=$("#grid").jqGrid("getRowData",e[t]),a=jQuery("#"+e[t],jQuery("#grid"));a.addClass("context-menu"),check_date(i.expireddate)<=30&&i.expireddate.length>0&&(a.removeClass("ui-widget-content"),a.addClass("argent")),check_date(i.expireddate)>=30&&check_date(i.expireddate)<=60&&i.expireddate.length>0&&(a.removeClass("ui-widget-content"),a.addClass("warning"))}}}),jQuery("#grid2").jqGrid({url:base_url+"/contract/index/archive",datatype:"json",mtype:"GET",height:"500",width:"1260",colNames:["#","Харьяа хэсэг","Гэрээний №","Гэрээ","Талууд","filename","Үйлдэл"],colModel:[{name:"id",index:"id",search:!1,width:20},{name:"section",index:"section",width:40,align:"center"},{name:"contract_no",index:"contract_no",width:40,align:"center"},{name:"title",index:"title",width:220,align:"left",formatter:archive_link},{name:"sides",index:"sides",width:150,align:"right"},{name:"filename",index:"filename",hidden:!0},{name:"action",index:"action",width:40,align:"center",sortable:!1,search:!1,formatter:archive_action}],jsonReader:{page:"page",total:"total",records:"records",root:"rows",repeatitems:!1,id:"id"},rowNum:20,rowList:[10,20,30],pager:"#pager",sortname:"id",viewrecords:!0,sortorder:"asc",caption:" Гэрээний архив ",loadComplete:function(){for(var e=$(this).jqGrid("getDataIDs"),t=0;t<e.length;t++){var i=$("#grid").jqGrid("getRowData",e[t]),a=jQuery("#"+e[t],jQuery("#grid"));check_date(i.expireddate)<=30&&i.expireddate.length>0&&(a.removeClass("ui-widget-content"),a.addClass("argent")),check_date(i.expireddate)>=30&&check_date(i.expireddate)<=60&&i.expireddate.length>0&&(a.removeClass("ui-widget-content"),a.addClass("warning"))}}}),jQuery("#grid2").jqGrid("filterToolbar",{stringResult:!0,searchOnEnter:!0,defaultSearch:"cn"}),jQuery("#grid").jqGrid("filterToolbar",{stringResult:!0,searchOnEnter:!0,defaultSearch:"cn"}),jQuery("#grid_freq").jqGrid({url:base_url+"/contract/index/archive",datatype:"json",mtype:"GET",height:"500",width:"1260",colNames:["#","Харьяа хэсэг","Гэрээний №","Гэрээ","Талууд","Төлбөр баримт","Үйлдэл"],colModel:[{name:"id",index:"id",search:!1,width:20},{name:"section",index:"section",width:40,align:"center"},{name:"contract_no",index:"contract_no",width:40,align:"center"},{name:"title",index:"title",width:220,align:"left",formatter:archive_link},{name:"sides",index:"sides",width:150,align:"right"},{name:"filename",index:"filename",hidden:!0},{name:"action",index:"action",width:40,align:"center",sortable:!1,search:!1,formatter:t_action}],jsonReader:{page:"page",total:"total",records:"records",root:"rows",repeatitems:!1,id:"id"},rowNum:20,rowList:[10,20,30],pager:"#pager",sortname:"id",viewrecords:!0,sortorder:"asc",caption:" Давтамжийн зөвшөөрөл ",loadComplete:function(){for(var e=$(this).jqGrid("getDataIDs"),t=0;t<e.length;t++){var i=$("#grid_freq").jqGrid("getRowData",e[t]),a=jQuery("#"+e[t],jQuery("#grid"));check_date(i.expireddate)<=30&&i.expireddate.length>0&&(a.removeClass("ui-widget-content"),a.addClass("argent")),check_date(i.expireddate)>=30&&check_date(i.expireddate)<=60&&i.expireddate.length>0&&(a.removeClass("ui-widget-content"),a.addClass("warning"))}}}),jQuery("#grid_freq").jqGrid("filterToolbar",{stringResult:!0,searchOnEnter:!0}),$("#back").click(function(){document.location=base_url+"/training/"}),$("#valid_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0,opened:!1}),$("#issued_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0,opened:!1}),$(".enter_dt").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0,opened:!1}),$(".year_dt").datepicker({dateFormat:"yy,mm,dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0,opened:!1})});