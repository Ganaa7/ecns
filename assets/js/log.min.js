function set_select(){var e="",t=0;return $("#section_id option").each(function(){e=$(this).text()+":"+$(this).text(),t++}),t>1&&(e=":Бүгд;Холбоо:Холбоо;Навигаци:Навигаци;Ажиглалт:Ажиглалт;Гэрэл суулт, цахилгаан:ГСЦ"),e}function jqgrid(){jQuery("#grid").jqGrid({url:base_url+"/log/index/grid",datatype:"xml",mtype:"GET",colNames:["Зэрэглэл","Хэсэг","Гэмтэл №","Нээсэн хугацаа","Байршил","Төхөөрөмж","Гэмтэл","Хаасан хугацаа","Үргэлж/цаг","Гүйцэтгэл","Үйлдэл","Closed"],colModel:[{name:"q_level",index:"q_level",width:55,align:"center"},{name:"section",index:"section",width:90,stype:"select",searchoptions:{value:sel_str}},{name:"log_num",index:"log_num",width:50},{name:"created_datetime",index:"created_datetime",width:80,searchoptions:{dataInit:function(e){$(e).datepicker({dateFormat:"yy-mm-dd"}).change(function(){$("#grid")[0].triggerToolbar()})}}},{name:"location",index:"location",width:60,align:"center",formatter:view_link},{name:"equipment",index:"equipment",width:90,formatter:view_link},{name:"defect",index:"defect",width:130,align:"left",formatter:view_link},{name:"closed_datetime",index:"closed_datetime",width:80,align:"right",searchoptions:{dataInit:function(e){$(e).datepicker({dateFormat:"yy-mm-dd"}).change(function(){$("#grid")[0].triggerToolbar()})}}},{name:"duration_time",index:"duration_time",width:50,align:"center"},{name:"completion",index:"completion",width:160,sortable:!0},{name:"act",index:"act",width:90,align:"center",sortable:!1,formatter:log_action},{name:"closed",index:"closed",hidden:!0,viewable:!0}],pager:jQuery("#pager"),rowNum:20,rowList:[10,20,30,40],sortname:"log_id",sortorder:"desc",viewrecords:!0,imgpath:"themes/basic/images",caption:"Гэмтэл дутагдал",autowidth:!0,height:500,width:"100%",editurl:"server.php",loadComplete:function(){for(var e=$(this).jqGrid("getDataIDs"),t=0;t<e.length;t++){var o=$("#grid").jqGrid("getRowData",e[t]),i=jQuery("#"+e[t],jQuery("#grid"));switch(o.closed){case"C":i.removeClass("ui-widget-content"),i.addClass("warning");break;case"A":i.removeClass("ui-widget-content"),i.addClass("argent");break;case"N":i.removeClass("ui-widget-content"),i.addClass("warning");break;case"Q":i.removeClass("ui-widget-content"),i.addClass("qualify");break;case"F":i.removeClass("ui-widget-content"),i.addClass("file")}}}}).navGrid("#pager",{edit:!1,add:!1,del:!1,search:!1}),jQuery("#grid").jqGrid("filterToolbar",{stringResult:!0,searchOnEnter:!1,beforeSearch:function(){$("#section_id").val(""),$("#sector_id").val(""),$("#equipment_id").val(""),$("#date_option").val(""),$("#start_dt").val(""),$("#end_dt").val("")}})}function view_link(e,t){return"<a href='#' onclick='init_view("+t.rowId+")' >"+e+"</a>"}function log_action(e,t,o){action_str="<div title='Дэлгэрэнгүй' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit'><span id='log_none' onclick='init_view("+t.rowId+")' class='ui-icon ui-icon-extlink'></span></div></div>";$("#action").serializeArray();return $("input.action").each(function(){switch($(this).val()){case"activate":action_str=action_str+"<div title='Зөвшөөрөл өгөх' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit'><span id='log_approve' onclick='initApprove("+t.rowId+")' class='ui-icon ui-icon-unlocked'></span></div>";break;case"quality":action_str=action_str+"<div title='Эрсдэл үнэлэх' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit'><span onclick='init_quality("+t.rowId+")' class='ui-icon ui-icon-check'></span></div></div>";break;case"close":action_str=action_str+"<div title='Хаах' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit'><span onclick='init_close("+t.rowId+")' class='ui-icon ui-icon-wrench'></span></div></div>";break;case"edit":action_str=action_str+"<div style='margin-left:8px;'><div title='Засах' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit'><span onclick='init_edit("+t.rowId+")' class='ui-icon ui-icon-pencil'></span></div>";break;case"delete":action_str=action_str+"<div title='Устгах' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit'><span onclick='_delete("+t.rowId+")' target ="+t.log_num+" class='ui-icon ui-icon-trash'></span></div></div>";break;case"fileupload":action_str=action_str+"<div title='Тайлангийн файл' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit'><span onclick='init_upload("+t.rowId+")' target ="+t.log_num+" class='ui-icon ui-icon-link'></span></div></div>"}}),action_str}function open_dialog(){open.dialog("option","title","Гэмтлийн бүртгэл шинээр нээх"),open.dialog({buttons:{"Нээх":function(){$("p.feedback",open).removeClass("success, error").addClass("notify").html("Утгуудыг сервер руу илгээж байна...").show();var e={};$('input[type="text"], input[type="hidden"], select, textarea',open).each(function(){var t=$(this);e[t.attr("name")]=t.val()}),$.ajax({type:"POST",url:base_url+"/log/index/add/",data:e,dataType:"json",success:function(e){"success"==e.status?(open.dialog("close"),showMessage(e.message,"success"),reload()):$("p.feedback",open).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){open.dialog("close")}}}),open.dialog("open")}function initApprove(e){var t,o={id:e};$.ajax({type:"POST",url:base_url+"/log/index/catch/",data:o,dataType:"json",success:function(e){$("#log_id",approve).val(e.log.log_id),$("#closed",approve).val(e.log.closed),$("#log_num",approve).val(e.log.log_num),$("#equipment_id",approve).val(e.log.equipment_id),null===e.log.log_num?$("#log_num_txt",approve).text("Зөвшөөрөх дарахад автоматаар олгогдоно."):$("#log_num_txt",approve).text(e.log.log_num),$("#section",approve).text(e.log.section),$("#created_datetime",approve).text(e.log.created_datetime),$("#createdby_id",approve).text(e.log.createdby),$("#location_id",approve).text(e.log.location),$("#equipment_id",approve).text(e.log.equipment),$("#defect",approve).text(e.log.defect),$("#reason",approve).text(e.log.reason),e.log.inst&&($("#inst option[value="+e.log.inst+"]",approve).attr("selected","selected"),$("#level option[value="+e.log.level+"]",approve).attr("selected","selected"),$("#inst",approve).prop("disabled",!0),$("#level",approve).prop("disabled",!0)),"Y"==e.log.closed||"N"==e.log.closed?($("#closed_datetime",approve).text(e.log.closed_datetime),$("#duration",approve).text(e.log.duration_time),$("#closedby_id",approve).text(e.log.closedby),$("#completion",approve).text(e.log.completion),$("#wrap_closed",approve).show()):$("#wrap_closed",approve).hide(),e.log.log_num?title='"'+e.log.log_num+'" дугаартай гэмтэл':title="Гэмтэл",t="A"==e.log.closed||"Y"==e.log.closed||"Q"==e.log.closed||"F"==e.log.closed?"activated":"activate"}}).done(function(){_call_fn(t,title)})}function approve_dialog(e){console.log("called"),approve.dialog("option","title",e),approve.dialog({buttons:{"Зөвшөөрөх":function(){$("p.feedback",approve).removeClass("success, error").addClass("notify").html("Утгуудыг сервер руу илгээж байна...").show();var e={};$('input[type="text"], input[type="hidden"], select',approve).each(function(){var t=$(this);e[t.attr("name")]=t.val()}),$.ajax({type:"POST",url:base_url+"/log/index/active/",data:e,dataType:"json",success:function(e){"success"==e.status?(approve.dialog("close"),showMessage(e.message,"success"),reload()):$("p.feedback",approve).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){approve.dialog("close")}}}),approve.dialog("open")}function button_bind(){$("#create_log").click(function(){open_dialog()}),$("#close_log").click(function(){var e=$("#grid").jqGrid("getGridParam","selrow");e?init_close(e):alert("Хаах гэмтлийг сонгоно уу!")}),$("#log_active").click(function(){var e=$("#grid").jqGrid("getGridParam","selrow");e?initApprove(e):alert("Зөвшөөрөх гэмтлийг сонгоно уу!")}),$("#quality").click(function(){var e=$("#grid").jqGrid("getGridParam","selrow");e?init_quality(e):alert("Эрсдэл үнэлэх гэмтлийг сонгоно уу!")}),$("#log_delete").click(function(){var e=$("#grid").jqGrid("getGridParam","selrow");e?_delete(e):alert("Устгах гэмтлийг сонгоно уу!")}),$("#log_edit").click(function(){var e=$("#grid").jqGrid("getGridParam","selrow");e?init_edit(e):alert("Засах гэмтлийг сонгоно уу!")})}function init_edit(e){var t,o,i={id:e};$.ajax({type:"POST",url:base_url+"/log/index/catch/",data:i,dataType:"json",success:function(e){$("#log_id",edit).val(e.log.log_id),$("#log_num",edit).val(e.log.log_num),$("#closed",edit).val(e.log.closed),$("#created_datetime_e",edit).val(e.log.created_datetime),$("#location_id option[value="+e.log.location_id+"]",edit).attr("selected","selected"),$("#equipment_id option[value="+e.log.equipment_id+"]",edit).attr("selected","selected"),$("#defect",edit).val(e.log.defect),$("#reason",edit).val(e.log.reason),"Q"==e.log.closed||"N"==e.log.closed?($("#closed_datetime",edit).val(e.log.closed_datetime),$("#duration",edit).val(e.log.duration_time),$("#completion",edit).val(e.log.completion),$("#wrap_closed",edit).show()):$("#wrap_closed",edit).hide(),o="C"==e.log.closed?"created":"A"==e.log.closed||"Q"==e.log.closed||"N"==e.log.closed?"edit":"no_edit",t=e.log.log_num?'"'+e.log.log_num+'" дугаартай гэмтэл засах':"Гэмтэл засах"}}).done(function(){_call_fn(o,t)})}function edit_dialog(e){edit.dialog("option","title",e),edit.dialog({buttons:{"Засах":function(){$("p.feedback",edit).removeClass("success, error").addClass("notify").html("Утгуудыг сервер руу илгээж байна...").show();var e={};$('input[type="text"], input[type="hidden"], select, textarea',edit).each(function(){var t=$(this);e[t.attr("name")]=t.val()}),e.closed_datetime>e.created_datetime?e.duration_time=1:e.duration_time=0,$.ajax({type:"POST",url:base_url+"/log/index/ajax_update/",data:e,dataType:"json",success:function(e){"success"==e.status?(edit.dialog("close"),showMessage(e.message,"success"),reload()):$("p.feedback",edit).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){edit.dialog("close")}}}),edit.dialog("open")}function init_close(e){var t,o={id:e};$.ajax({type:"POST",url:base_url+"/log/index/catch/",data:o,dataType:"json",success:function(e){$("#log_id",close).val(e.log.log_id),$("#log_num",close).val(e.log.log_num),$("#closed",close).val(e.log.closed),$("#equipment_id",close).val(e.log.equipment_id),null===e.log.log_num?$("#log_num_txt",close).text("Зөвшөөрөх дарахад автоматаар олгогдоно."):$("#log_num_txt",close).text(e.log.log_num),$("#created_datetime_txt",close).text(e.log.created_datetime),$("#created_datetime",close).val(e.log.created_datetime),$("#location",close).text(e.log.location),$("#equipment",close).text(e.log.equipment),t="N"==e.log.closed?"closing":"Y"==e.log.closed||"Q"==e.log.closed||"F"==e.log.closed?"closed":"C"==e.log.closed?"created":"close",$("#defect",close).text(e.log.defect),$("#reason",close).text(e.log.reason)}}).done(function(){_call_fn(t,title=null)})}function close_dialog(){close.dialog("option","title","Гэмтлийн бүртгэл хаах"),close.dialog({buttons:{"Хадгалах":function(){$("p.feedback",close).removeClass("success, error").addClass("notify").html("Утгуудыг сервер руу илгээж байна...").show();var e={};$('input[type="text"], input[type="hidden"], select, textarea',close).each(function(){var t=$(this);e[t.attr("name")]=t.val()}),e.closed_datetime>e.created_datetime?e.duration_time=1:e.duration_time=0,$.ajax({type:"POST",url:base_url+"/log/index/close/",data:e,dataType:"json",success:function(e){"success"==e.status?(close.dialog("close"),showMessage(e.message,"success"),reload()):$("p.feedback",close).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){close.dialog("close")}}}),close.dialog("open")}function reload(){$("#grid").trigger("reloadGrid")}function _delete(e){var t={id:e},o=$("#grid").getRowData(e);window.confirm("Та '"+o.log_num+"' дугаартай гэмтлийг устгахдаа итгэлтэй байна уу?")&&$.ajax({type:"POST",url:base_url+"/log/index/delete/",data:t,dataType:"json",success:function(e){"success"==e.status&&(showMessage(e.message,"success"),reload())}})}function init_upload(e){var t={id:e};$.ajax({type:"POST",url:base_url+"/log/index/catch/",data:t,dataType:"json",success:function(e){$("#log_id",file).val(e.log.log_id),$("#log_num",file).val(e.log.log_num),$("input[name=created_datetime]",file).val(e.log.created_datetime),$("#createdby_id option[value="+e.log.createdby_id+"]",file).attr("selected","selected"),$("#location_id option[value="+e.log.location_id+"]",file).attr("selected","selected"),$("#equipment_id option[value="+e.log.equipment_id+"]",file).attr("selected","selected"),$("#defect",file).val(e.log.defect),$("#reason",file).val(e.log.reason),"Y"==e.log.closed||"Q"==e.log.closed||"N"==e.log.closed||"F"==e.log.closed?($("#closed_datetime",file).val(e.log.closed_datetime),$("#duration",file).val(e.log.duration_time),$("#closedby_id option[value="+e.log.closedby_id+"]",file).attr("selected","selected"),$("#completion",file).val(e.log.completion),$("#wrap_closed",file).show()):$("#wrap_closed",file).hide(),"C"==e.log.closed||"Q"==e.log.closed||"A"==e.log.closed||"N"==e.log.closed?state="nofile":"Y"==e.log.closed?state="hasfile":"F"==e.log.closed&&(state="file"),e.log.log_num&&(title='"'+e.log.log_num+'" дугаартай гэмтэлийн дэлгэрэнгүй')}}).done(function(){console.log("done:"+state+":"+title),_call_fn(state,title)})}function _upload(e){file.dialog("option","title",e),file.dialog({buttons:{"Хаах":function(){file.dialog("close")}}}),file.dialog("open")}function _file(e){var t={id:e};$.ajax({type:"POST",url:base_url+"/log/index/catch/",data:t,dataType:"json"}).done(function(e){console.log("file"+e.log.filename),$.ajax({url:base_url+"/download/log_files/"+e.log.filename,type:"HEAD"}).done(function(t,o,i){window.location(base_url+"/log/download/"+e.log.filename)}).fail(function(e,t,o){$(".ui-dialog").is(":visible")?feeds("error","Энэ гэмтлийн тайлангийн файлыг хавсаргаагүй тул харуулах боломжгүй!"):showMessage("Энэ гэмтлийн тайлангийн файлыг хавсаргаагүй тул харуулах боломжгүй!","error")})})}function del_file(e,t){if(1!=confirm("["+t+"] энэ файлыг устгахдаа итгэлтэй байна уу?"))return 0;$.ajax({type:"POST",url:base_url+"/log/index/del_file/"+e,data:{id:e,file_name:t},dataType:"json",success:function(e){e.success?(feeds("success",e.message),$("#file_link",file).remove(),$("#cert_file").show()):(feeds("error",e.message),$("#file_link",file).remove(),$("#cert_file").show())}})}function feeds(e,t){$("p.feedback",file).hasClass("error")&&$("p.feedback",file).removeClass("error"),$("p.feedback",file).hasClass("success")&&$("p.feedback",file).removeClass("success"),$("p.feedback",file).addClass(e).html(t).show(),$("p.feedback",file).stop().fadeIn("fast",function(){$("p.feedback",file).delay(5e3).fadeOut()})}function showMessage(e,t){$("p#notification").length||$("#nav-bar").prepend('<p id="notification"></p>');var o=$("p#notification");o.hide(),o.removeClass(),o.addClass(t),o.html(e),o.fadeIn("fast",function(){o.delay(3e3).fadeOut()})}function filter_post(e,t,o,i){$.post(base_url+"/log/log_plugin",{id:t,field:o,table:i},function(e){var t=$("#"+i+"_id");if(t.prop)o=t.prop("options");else var o=t.attr("options");$("option",t).remove(),$.each(e,function(e,t){o[o.length]=new Option(t,e)})})}function filter_event(e){$("#section_id",e).change(function(){var t=$(this).val();filter_post(e,t,"section_id","sector"),filter_post(e,t,"section_id","equipment")}),$("#sector_id",e).change(function(){var t=$(this).val();$("#section_id option[value="+~~(t/10)+"]",e).attr("selected","selected"),filter_post(e,t,"sector_id","equipment")})}function init_view(e){var t={id:e};$.ajax({type:"POST",url:base_url+"/log/index/catch/",data:t,dataType:"json",success:function(e){$("#log_id",view).val(e.log.log_id),$("#log_num",view).val(e.log.log_num),$("input[name=created_datetime]",view).val(e.log.created_datetime),$("#createdby_id option[value="+e.log.createdby_id+"]",view).attr("selected","selected"),$("#location_id option[value="+e.log.location_id+"]",view).attr("selected","selected"),$("#equipment_id option[value="+e.log.equipment_id+"]",view).attr("selected","selected"),$("#defect",view).val(e.log.defect),$("#reason",view).val(e.log.reason),"Y"==e.log.closed||"N"==e.log.closed||"F"==e.log.closed||"Q"==e.log.closed?($("#closed_datetime",view).val(e.log.closed_datetime),$("#duration",view).val(e.log.duration_time),$("#closedby_id option[value="+e.log.closedby_id+"]",view).attr("selected","selected"),$("#completion",view).val(e.log.completion),$("#wrap_closed",view).show(),"A"!=e.log.level&&"B"!=e.log.level&&"C"!=e.log.level||($("#show_file",view).html(""),e.log.filename?$("#show_file",view).html("<span>Тайлангийн файл:</span>  <span id='file_link'><a href='"+base_url+"/download/log_files/"+e.log.filename+"' download style='color:blue'>"+e.log.filename+"</a></span>"):$("#show_file",view).html("<span>Тайлангийн файл:</span>  <span id='file_link'>Файл оруулаагүй байна!</span>"))):$("#wrap_closed",view).hide(),e.log.log_num?title='"'+e.log.log_num+'" дугаартай гэмтэлийн дэлгэрэнгүй':title="Гэмтлийн дэлгэрэнгүй"}}).done(function(){view.dialog("option","title",title),view.dialog({buttons:{"Хаах":function(){view.dialog("close")}}}),view.dialog("open")})}function init_quality(e){var t,o={id:e};$.ajax({type:"POST",url:base_url+"/log/index/catch/",data:o,dataType:"json",success:function(e){$("#log_id",quality).val(e.log.log_id),$("#log_num",quality).val(e.log.log_num),$("input[name=created_datetime]",quality).val(e.log.created_datetime),$("#createdby_id option[value="+e.log.createdby_id+"]",quality).attr("selected","selected"),$("#location_id option[value="+e.log.location_id+"]",quality).attr("selected","selected"),$("#equipment_id option[value="+e.log.equipment_id+"]",quality).attr("selected","selected"),$("#defect",quality).val(e.log.defect),$("#reason",quality).val(e.log.reason),t="C"==e.log.closed||"A"==e.log.closed?"created":e.log.q_level?"qualified":"N"==e.log.closed?"notactive":"Q"==e.log.closed?"quality":"closed","N"==e.log.closed||"Q"==e.log.closed?($("#closed_datetime",quality).val(e.log.closed_datetime),$("#duration",quality).val(e.log.duration_time),$("#closedby_id option[value="+e.log.closedby_id+"]",quality).attr("selected","selected"),$("#completion",quality).val(e.log.completion),$("#wrap_closed",quality).show()):$("#wrap_closed",quality).hide(),$("#level",quality).val(e.log.level),$("#inst option[value="+e.log.inst+"]",quality).attr("selected","selected"),e.log.log_num?title='"'+e.log.log_num+'" дугаартай гэмтлийн эрсдэл үнэлэх':title="Гэмтлийн эрсдэл үнэлэх"}}).done(function(){_call_fn(t,title),console.log("state:"+t)})}function _quality(e){quality.dialog("option","title",e),quality.dialog({buttons:{"Хадгалах":function(){$("p.feedback",quality).removeClass("success, error").addClass("notify").html("Утгуудыг сервер руу илгээж байна...").show();var e={};$('input[type="text"], input[type="hidden"], select',quality).each(function(){var t=$(this);e[t.attr("name")]=t.val()}),$.ajax({type:"POST",url:base_url+"/log/index/quality/",data:e,dataType:"json",success:function(e){"success"==e.status?(quality.dialog("close"),showMessage(e.message,"success"),reload()):$("p.feedback",quality).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){quality.dialog("close")}}}),quality.dialog("open")}function _call_fn(e,t){switch(e){case"activated":alert('Аль хэдийн "Зөвшөөрөх" үйлдэл хийгдсэн тул дахиж хийх шаардлагагүй!');break;case"activate":approve_dialog(t);break;case"notactive":alert('Гэмтлийг "Ерөнхий зохицуулагч инженер" зөвшөөрсний дараа энэ үйлдэл боломжтой!');break;case"closing":alert("Хаах хүсэлтийг аль хэдийн илгээсэн тул энэ үйлдэл шаардлагагүй!");break;case"closed":alert("Энэ гэмтэл аль хэдийн хаагдсан тул дахиж хаах шаардлагагүй!");break;case"close":close_dialog();break;case"created":alert("Шинээр нээсэн гэмтэл дээр энэ үйлдэл боломжгүй!");break;case"qualified":1==confirm("Энэ гэмтлийн эсрдлийг аль хэдийн үнэлсэн байна! \n Та дахин үнэлэх үү?")&&_quality();break;case"quality":_quality();break;case"edit":edit_dialog(t);break;case"no_edit":alert("Энэ гэмтлийг аль хэдийн үнэлсэн учраас засах боломжгүй!");break;case"prevent":alert("Энэ үйлдэл хийгдэх боломжгүй!!!");break;case"nofile":alert("ААЧУХ гэмтлийн аюулыг шинжилж эрсдлийг тогтоосны дараа \n [А, B, C] эрсдэлтэй гэмтлүүдэд тайлангийн файл хавсаргах шаардлагатай!");break;case"hasfile":alert("Файл хавсаргах шаардлагагүй!\n Дэлгэрэнгүй хэсэг дээр дарж харна уу!");break;case"file":_upload(t)}}function warn_page(){var e=$("#grid").jqGrid("getGridParam","selrow");e?window.location=base_url+"/log/warnpage/"+e:alert("Нэг гэмтлийг сонгоно уу!")}var open,edit,approve,close,view,quality,role,action_str,sel_str,file;window.open=!1,$(document).ready(function(){role=$("#user_role").val(),sel_str=set_select(),(open=$("#open_dialog")).dialog({autoOpen:!1,width:550,resizable:!1,modal:!0,close:function(){$("p.feedback",open).html("").hide(),$('input[type="text"], input[type="hidden"], select, textarea',open).val(""),$(this).dialog("close")}}),(edit=$("#edit_dialog")).dialog({autoOpen:!1,width:570,resizable:!1,modal:!0,close:function(){$("p.feedback",edit).removeClass("error").html("").hide(),$('input[type="text"], input[type="hidden"]',edit).val(""),$(this).dialog("close")}}),(approve=$("#approve_dialog")).dialog({autoOpen:!1,width:570,resizable:!1,modal:!0,close:function(){$("p.feedback",approve).removeClass("error").html("").hide(),$('input[type="text"], input[type="hidden"], select',approve).val(""),$(this).dialog("close")}}),(close=$("#close_dialog")).dialog({autoOpen:!1,width:550,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"], input[type="hidden"], select, textarea',$(this)).val(""),$(this).dialog("close")}}),(view=$("#view_dialog")).dialog({autoOpen:!1,width:550,resizable:!1,modal:!0,close:function(){$('input[type="text"], input[type="hidden"], select, textarea',view).val(""),$(this).dialog("close"),$("#show_file",view).html("")}}),(quality=$("#quality_dialog")).dialog({autoOpen:!1,width:570,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"], input[type="hidden"], select, textarea',$(this)).val(""),$(this).dialog("close")}}),(file=$("#file_dialog")).dialog({autoOpen:!1,width:550,resizable:!1,modal:!0,close:function(){$("p.feedback",file).html("").hide(),$('input[type="text"], input[type="hidden"], select, textarea',open).val(""),$(this).dialog("close")}}),jqgrid(),button_bind(),$("#show").on("click",function(){$("#open_dialog").dialog("open")}),$("#created_datetime",open).datetimepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0,opened:!1}),$("#created_datetime_e",edit).datetimepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0}),$("#closed_datetime",edit).datetimepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0}),$("#c_closed_datetime",close).datetimepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!1}),$("#start_dt").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0}),$("#end_dt").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0});var e=$("#log_filter");filter_event(e),$("#filterBtn",e).click(function(){$("#gs_q_level").val(""),$("#gs_section").val(""),$("#gs_section").val(""),$("#gs_log_num").val(""),$("#gs_created_datetime").val(""),$("#gs_location").val(""),$("#gs_equipment").val(""),$("#gs_defect").val(""),$("#gs_closed_datetime").val(""),$("#gs_duration_time").val(""),$("#gs_completion").val("");var t={};$('input[type="text"], input[type="hidden"], select',e).each(function(){var e=$(this);t[e.attr("name")]=e.val()}),(t.start_dt||t.end_dt)&&"0"==t.date_option?(alert("Огнооны төрлийг сонгоно уу!"),$("#date_option").focus()):jQuery("#grid").jqGrid("setGridParam",{url:base_url+"/log/index/grid",page:1,search:!1,postData:{filters:"",section_id:t.section_id,sector_id:t.sector_id,equipment_id:t.equipment_id,log:t.log,date_option:t.date_option,start_dt:t.start_dt,end_dt:t.end_dt}}).trigger("reloadGrid")}),$("#cert_file",file).change(function(){var e=new FormData($("#file_dialog")[0]);$.ajax({url:base_url+"/log/index/upload/",type:"POST",data:e,processData:!1,contentType:!1,success:function(e){console.log("json"+JSON.stringify(e)),"success"==e.status?(feeds("success",e.name+" нэртэй файлыг амжилттай байршууллаа!"),e.name&&($("input[type='file",file).val("").hide(),$("#_file",file).lenght||$("#_file",file).append("<span id='file_link'><a href='"+base_url+"/download/log_files/"+e.name+"' download style='color:blue'>"+e.name+"</a> (<a href='#' style='color:red' onclick='del_file("+e.log_id+', "'+e.name+"\")'>Устгах</a>)</span>"))):(feeds("error",e.message),$("input[type='file",file).val(""))}})})});