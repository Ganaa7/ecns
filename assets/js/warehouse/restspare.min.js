$(function(){var grid=$("#grid");grid.jqGrid({url:"/ecns/wm_ajax/restspare",datatype:"xml",mtype:"GET",colNames:["\u041e\u043d","\u0425\u044d\u0441\u044d\u0433","\u0422\u0430\u0441\u0430\u0433","\u0422\u04e9\u0445\u04e9\u04e9\u0440\u04e9\u043c\u0436","\u0421\u044d\u043b\u0431\u044d\u0433","\u0410\u0448\u0438\u0433\u043b\u0430\u0436 \u0431\u0443\u0439 \u0442\u043e\u043e/\u0448","\u0411\u0430\u0439\u0445 \u0451\u0441\u0442\u043e\u0439 \u0442\u043e\u043e/\u0448","\u042d\u0445\u043d\u0438\u0439/\u04af\u043b\u0434",
"\u042d\u0446\u0441\u0438\u0439\u043d/\u04af\u043b\u0434","\u0425\u0430\u0434\u0433\u0430\u043b\u0441\u0430\u043d","\u04ae\u0439\u043b\u0434\u044d\u043b"],colModel:[{name:"year",index:"year",width:20,align:"right"},{name:"section",index:"section",width:30},{name:"sector",index:"sector",width:40},{name:"equipment",index:"equipment",width:45},{name:"spare",index:"spare",width:80},{name:"usingQty",index:"usingQty",width:35,align:"right"},{name:"needQty",index:"needQty",width:35,align:"right"},{name:"beginQty",
index:"beginQty",width:30,align:"right"},{name:"endQty",index:"endQty",width:30,align:"right"},{name:"recordby",index:"recordby",width:30},{name:"action",index:"action",width:30,formatter:incomeAction}],pager:jQuery("#pager"),rowNum:15,rowList:[15,20,30],sortname:"spare_id",sortorder:"desc",viewrecords:true,caption:"\u041d\u044d\u0433\u0434\u0441\u044d\u043d \u0431\u04af\u0440\u0442\u0433\u044d\u043b::\u0421\u044d\u043b\u0431\u044d\u0433\u0438\u0439\u043d \u0436\u0430\u0433\u0441\u0430\u0430\u043b\u0442",
autowidth:true,height:400,width:"100%",subGrid:false}).navGrid("#pager",{edit:false,add:false,del:false,search:true});$("#searchbtn").click(function(){jQuery("#grid").jqGrid("searchGrid",{sopt:["eq","ne","cn","bw","lt","gt","ew"]})});function incomeAction(cellvalue,options,rowObjcet){if(cellvalue==="action")return'<a href ="#" onclick =editRestSpare('+options.rowId+')>\u0417\u0430\u0441\u0430\u0445</a> | <a href = "#" onclick="delRestSpare('+options.rowId+')">\u0423\u0441\u0442\u0433\u0430\u0445</a>';
else return""}$("#search").click(function(){var spare_id=$("#spare_id").val(),spare=$("#spare").val();if(spare_id==0&&(spare=!null||spare!=""))alert("\u0418\u0439\u043c \u0441\u044d\u043b\u0431\u044d\u0433 \u0431\u0430\u0439\u0445\u0433\u04af\u0439 \u0431\u0430\u0439\u043d\u0430!");else{if((spare==null||spare=="")&spare_id!=0)spare_id=0;grid.jqGrid("setGridParam",{url:"/ecns/wm_ajax/restspare?spare_id="+spare_id,page:1}).trigger("reloadGrid")}});$("#filterBy").click(function(){var section_id=$("#section_id").val(),
sector_id=$("#sector_id").val(),equipment_id=$("#equipment_id").val();if(section_id!="0"||sector_id!="0"||equipment_id!="0")$("#grid").jqGrid("setGridParam",{url:"/ecns/wm_ajax/restspare?section_id="+section_id+"&sector_id="+sector_id+"&equipment_id="+equipment_id,page:1,search:true}).trigger("reloadGrid");else $("#grid").jqGrid("setGridParam",{url:"/ecns/wm_ajax/restspare",page:1,search:false}).trigger("reloadGrid")});$("#dialog").dialog({autoOpen:false,width:450,modal:true,buttons:[{text:"\u0413\u04af\u0439\u0446\u0441\u044d\u043d",
click:function(){if($("#spare2").val()==0||$("#spare2").val()==null){alert("\u041d\u044d\u0433 \u0441\u044d\u043b\u0431\u044d\u0433 \u0441\u043e\u043d\u0433\u043e\u043d\u043e \u0443\u0443?");$("#spare2").focus()}else if($("#regdate").val()==0||$("#regdate").val()==null){alert("\u041e\u0433\u043d\u043e\u043e\u0433 \u0441\u043e\u043d\u0433\u043e\u043d\u043e \u0443\u0443?");$("#regdate").focus()}else if($("#usingQty").val()==0||$("#usingQty").val()==null){alert("\u0410\u0448\u0438\u0433\u043b\u0430\u0441\u0430\u043d \u0442\u043e\u043e \u0445\u044d\u043c\u0436\u044d\u044d\u0433 \u043e\u0440\u0443\u0443\u043b!");
$("#usingQty").focus()}else if($("#needQty").val()==0||$("#needQty").val()==null){alert("\u0428\u0430\u0430\u0440\u0434\u043b\u0430\u0433\u0430\u0442\u0430\u0439 \u0442\u043e\u043e \u0445\u044d\u043c\u0436\u044d\u044d\u0433 \u043e\u0440\u0443\u0443\u043b!");$("#needQty").focus()}else $.post("/ecns/wm_ajax/insrest",{spare_id:$("#spare_id").val(),regdate:$("#regdate").val(),launchYear:$("#launchYear").val(),usingYear:$("#usingYear").val(),usingQty:$("#usingQty").val(),needQty:$("#needQty").val()}).done(function(data){$("#dialog").dialog("close");
$("#grid").jqGrid("setGridParam",{url:"/ecns/wm_ajax/restspare",page:1}).trigger("reloadGrid")})}},{text:"\u0411\u043e\u043b\u0438\u0445",click:function(){$(this).dialog("close")}}]});$("#dialog-link").click(function(event){$("#dialog").dialog("open");event.preventDefault()});$("#spare2").autocomplete({source:"spareJson",minLength:2,select:function(event,ui){if(ui.item.value){$("#spare_id").val(ui.item.id);$("#part_number").text(ui.item.part)}},search:function(event,ui){$("#part_number").text("");
$("#spare_id").val(0)}});$("#regdate").datepicker({dateFormat:"yy-mm-dd",showWeek:true,gotoCurrent:true});$("#edialog").dialog({autoOpen:false,width:450,modal:true,open:function(event,ui){$.post("/ecns/wm_ajax/getRestSpare",{spare_id:$("#espare_id").val()},function(result){$.each(result,function(value,text){switch(value){case "spare":$("#espare").text(text);break;case "part_number":$("#epart_number").text(text);break;case "date":$("#edate").val(text);break;case "usingQty":$("#eUsingQty").val(text);
break;case "needQty":$("#eNeedQty").val(text);break;case "launchyear":$("#elaunchYear").val(text);break;default:$("#eUsingYear").val(text);break}})});$("#espare").val("")},buttons:[{text:"\u0413\u04af\u0439\u0446\u0441\u044d\u043d",click:function(){if($("#edate").val()==null){alert("\u041e\u0433\u043d\u043e\u043e\u0433 \u0441\u043e\u043d\u0433\u043e\u043d\u043e \u0443\u0443?");$("#edate").focus()}else if($("#eUsingQty").val()==0||$("#eUsingQty").val()==null){alert("\u0410\u0448\u0438\u0433\u043b\u0430\u0441\u0430\u043d \u0442\u043e\u043e \u0445\u044d\u043c\u0436\u044d\u044d\u0433 \u043e\u0440\u0443\u0443\u043b!");
$("#eUsingQty").focus()}else if($("#eNeedQty").val()==0||$("#eNeedQty").val()==null){alert("\u0428\u0430\u0430\u0440\u0434\u043b\u0430\u0433\u0430\u0442\u0430\u0439 \u0442\u043e\u043e \u0445\u044d\u043c\u0436\u044d\u044d\u0433 \u043e\u0440\u0443\u0443\u043b!");$("#eNeedQty").focus()}else{$("#edialog").dialog("close");$.post("/ecns/wm_ajax/uRest",{spare_id:$("#espare_id").val(),regdate:$("#edate").val(),launchYear:$("#elaunchYear").val(),usingYear:$("#eUsingYear").val(),usingQty:$("#eUsingQty").val(),
needQty:$("#eNeedQty").val()}).done(function(data){$("#dialog").dialog("close");$("#grid").jqGrid("setGridParam",{url:"/ecns/wm_ajax/restspare",page:1}).trigger("reloadGrid")})}}},{text:"\u0411\u043e\u043b\u0438\u0445",click:function(){$(this).dialog("close")}}]});$("#edate").datepicker({dateFormat:"yy-mm-dd",showWeek:true,gotoCurrent:false})});function editRestSpare(spare_id){$("#espare_id").val(spare_id);$("#edialog").dialog("open");event.preventDefault()}
function delRestSpare(spare_id){var answer=confirm("\u042d\u043d\u044d \u0441\u044d\u043b\u0431\u044d\u0433\u0438\u0439\u043d \u0436\u0430\u0433\u0441\u0430\u0430\u043b\u0442\u0438\u0439\u0433 \u0443\u0441\u0442\u0433\u0430\u0445\u0434\u0430\u0430 \u0438\u0442\u0433\u044d\u043b\u0442\u044d\u0439 \u0431\u0430\u0439\u043d\u0430 \u0443\u0443?");if(answer)$.post("/ecns/wm_ajax/delRest",{spare_id:spare_id}).done(function(data){grid.jqGrid("setGridParam",{url:"/ecns/wm_ajax/restspare",page:1}).trigger("reloadGrid")})}
;