!function(e){e.extend(e.fn,{swapClass:function(e,a){var s=this.filter("."+e);return this.filter("."+a).removeClass(a).addClass(e),s.removeClass(e).addClass(a),this},replaceClass:function(e,a){return this.filter("."+e).removeClass(e).addClass(a).end()},hoverClass:function(a){return a=a||"hover",this.hover(function(){e(this).addClass(a)},function(){e(this).removeClass(a)})},heightToggle:function(e,a){e?this.animate({height:"toggle"},e,a):this.each(function(){jQuery(this)[jQuery(this).is(":hidden")?"show":"hide"](),a&&a.apply(this,arguments)})},heightHide:function(e,a){e?this.animate({height:"hide"},e,a):(this.hide(),a&&this.each(a))},prepareBranches:function(e){return e.prerendered||(this.filter(":last-child:not(ul)").addClass(a.last),this.filter((e.collapsed?"":"."+a.closed)+":not(."+a.open+")").find(">ul").hide()),this.filter(":has(>ul)")},applyClasses:function(s,l){if(this.closest("li").children("ul").children("li").children("span").add(e("a",this)).hoverClass(),!s.prerendered){this.filter(":has(>ul:hidden)").addClass(a.expandable).replaceClass(a.last,a.lastExpandable),this.not(":has(>ul:hidden)").addClass(a.collapsable).replaceClass(a.last,a.lastCollapsable);var t=this.find("div."+a.hitarea);t.length||(t=this.prepend('<div class="'+a.hitarea+'"/>').find("div."+a.hitarea)),t.removeClass().addClass(a.hitarea).each(function(){var a="";e.each(e(this).parent().attr("class").split(" "),function(){a+=this+"-hitarea "}),e(this).addClass(a)})}this.find("div."+a.hitarea).click(l)},treeview:function(s){function l(){e(this).parent().find(">.hitarea").swapClass(a.collapsableHitarea,a.expandableHitarea).swapClass(a.lastCollapsableHitarea,a.lastExpandableHitarea).end().swapClass(a.collapsable,a.expandable).swapClass(a.lastCollapsable,a.lastExpandable).find(">ul").heightToggle(s.animated,s.toggle),s.unique&&e(this).parent().siblings().find(">.hitarea").replaceClass(a.collapsableHitarea,a.expandableHitarea).replaceClass(a.lastCollapsableHitarea,a.lastExpandableHitarea).end().replaceClass(a.collapsable,a.expandable).replaceClass(a.lastCollapsable,a.lastExpandable).find(">ul").heightHide(s.animated,s.toggle)}function t(a,s){var l;return e.ajax({type:"POST",url:base_url+"/index.php/flog/jx_unchk_pr_error/",data:{equipment_id:s,id:a,location_id:f},dataType:"json",async:!1,success:function(e){"success"==e.status&&(l=e)}}),l.stored}function i(a,s,l){var t;return e.ajax({type:"POST",url:base_url+"/index.php/flog/jx_pr_error/",data:{equipment_id:s,id:a,node_type:l,location_id:f},dataType:"json",async:!1,success:function(e){t=(e.status,e)}}),t}function n(a,s,l){e.ajax({type:"POST",url:base_url+"/index.php/flog/jx_reverse/",data:{equipment_id:s,id:l,location_id:f},dataType:"json",async:!1,success:function(s){console.log(s),"success"==s.status&&("true"==s.result.result?c(a,s):(c(a,s),0==e(".node").length?e('#log_type_id option[value="0"]').prop("selected",!0):e('#log_type_id option[value="2"]').prop("selected",!0),ret_val=s))}})}function r(a){var s={};s.id=a.attr("id");var l=s.id;e.ajax({type:"POST",url:base_url+"/index.php/flog/index/node_select",async:!1,data:s,success:function(a){"success"==a.status&&(e("#tag_"+l).length?alert("Энэ мөчрийг аль хэдийн нэмсэн байна!"):(e("#wrapper-tag").append("<a class='btn-tag' id='tag_"+l+"'>"+a.node+"</a>"),e(u).append("<input type='hidden' name='node[]' class='node' id ='node_"+l+"' value='"+l+"'/>")))}})}function o(a,s){var l;return current_id=s.attr("id"),s.addClass("failure"),s.hasClass("undevelop")||e.ajax({type:"POST",url:base_url+"/index.php/flog/jx_logic/",data:{equipment_id:a,id:current_id,location_id:f},dataType:"json",async:!1,success:function(e){"success"==e.status&&("true"==e.logic.result?(p(s),l=e):(d(s,e),l=e))}}),l}function d(a,s){a=a.closest("li").closest("ul").closest("li");var l=e.map(s.error,function(e){return e});if(e.inArray(a.children("span").attr("id"),l)>-1)return a.children("span").addClass("failure"),document.getElementById("tag_"+a.children("span").attr("id"))||(e("#wrapper-tag").append("<a class='btn-tag' id='tag_"+a.children("span").attr("id")+"'>"+a.children("span").text()+"</a>"),e(u).append("<input type='hidden' name='node[]' class='node' id ='node_"+a.children("span").attr("id")+"' value='"+a.children("span").attr("id")+"'/>")),d(a,s)}function c(a,s){if((a=a.closest("li").closest("ul").closest("li")).length>0){var l=e.map(s.result.error,function(e){return e});return-1==parseInt(e.inArray(a.children("span").attr("id"),l))&&(a.children("span").removeClass("failure"),("#tag_"+a.children("span").attr("id")).length&&(e("#tag_"+a.children("span").attr("id")).remove(),e("#node_"+a.children("span").attr("id")).remove())),c(a,s)}}function p(a){if(a.closest("li").closest("ul").closest("li").children("span").text())return(a=a.closest("li").closest("ul").closest("li")).children("span").addClass("failure"),("#tag_"+a.children("span").attr("id")).length||(e("#wrapper-tag").append("<a class='btn-tag' id='tag_"+a.children("span").attr("id")+"'>"+a.children("span").text()+"</a>"),e(u).append("<input type='hidden' name='node[]' class='node' id ='node_"+a.children("span").attr("id")+"' value='"+a.children("span").attr("id")+"'/>")),p(a)}if(e.cookie("equipment_id",e("#vw_loc_equip_id").val()),e.cookie("call",1),(s=e.extend({cookieId:"treeview"},s)).toggle){var h=s.toggle;s.toggle=function(){return h.apply(e(this).parent()[0],arguments)}}this.data("toggler",l);var u="",f=e("#location_id").val();this.addClass("treeview");var v=this.find("li").prepareBranches(s);switch(s.persist){case"cookie":var _=s.toggle;s.toggle=function(){!function(){var a=[];v.each(function(s,l){a[s]=e(l).is(":has(>ul:visible)")?1:0}),e.cookie(s.cookieId,a.join(""),s.cookieOptions)}(),_&&_.apply(this,arguments)},function(){var a=e.cookie(s.cookieId);if(a){var l=a.split("");v.each(function(a,s){e(s).find(">ul")[parseInt(l[a])?"show":"hide"]()})}}();break;case"location":var g=this.find("a").filter(function(){return 0==location.href.toLowerCase().indexOf(this.href.toLowerCase())});if(g.length){var C=g.addClass("selected").parents("ul, li").add(g.next()).show();s.prerendered&&C.filter("li").swapClass(a.collapsable,a.expandable).swapClass(a.lastCollapsable,a.lastExpandable).find(">.hitarea").swapClass(a.collapsableHitarea,a.expandableHitarea).swapClass(a.lastCollapsableHitarea,a.lastExpandableHitarea)}}return v.applyClasses(s,l),s.control&&(!function(s,t){function i(t){return function(){return l.apply(e("div."+a.hitarea,s).filter(function(){return!t||e(this).parent("."+t).length})),!1}}e("a:eq(0)",t).click(i(a.collapsable)),e("a:eq(1)",t).click(i(a.expandable))}(this,s.control),e(s.control).show()),e(document).on("click","li > span.module",function(a){var l=e(this);e(".treeview li.highlight").removeClass("highlight"),e(" li > div."+s.mod_class+".children").removeClass("children"),e(a.target).closest("li").addClass("highlight"),e(".highlight li > span.module").addClass("children");var d="";d=e(this).hasClass("basic")?"basic":"not_basic";var c=e("#vw_loc_equip_id").val(),p=e(location).attr("href"),h=l.attr("id");l.text();if(u=p.indexOf("create_form")>=0&&e("#create_form").length?"#create_form":p.indexOf("edit")>=0&&e("#edit_form").length?"#edit_form":"#close_form",l.hasClass("top"))alert("Хамгийн дээд элементийг сонгох боломжгүй! Дэд хэсгүүдээс сонгоно уу!");else if("#create_form"==u||"#edit_from"==u)if(l.hasClass("failure"))l.hasClass("basic")||l.hasClass("undevelop")?l.hasClass("undevelop")?(l.removeClass("failure"),e("#node_"+h).remove(),e("#tag_"+h).remove(),0==e(".node").length&&e('#log_type_id option[value="0"]').prop("selected",!0)):(l.removeClass("failure"),e("#node_"+h).remove(),e("#tag_"+h).remove(),n(l,c,h)):1==t(h,c)?(l.removeClass("failure"),e("#node_"+h).remove(),e("#tag_"+h).remove(),n(l,c,h)):alert("Энэ үйлдлийг хийхийг зөвшөөрөхгүй учир нь [basic] буюу эцсийн элемент дээр алдаа өгсөн учраас!");else if(e(this).hasClass("undevelop"))r(l),l.addClass("failure"),1==e(".node").length&&e('#log_type_id option[value="2"]').prop("selected",!0);else{if("success"==(f=i(l.attr("id"),c,d)).status){r(l),l.addClass("failure");"true"==(v=o(c,l)).logic.result?e('#log_type_id option[value="1"]').prop("selected",!0):e('#log_type_id option[value="2"]').prop("selected",!0)}else alert("["+l.text()+"] энэ мөчир дээр эх мөчир аль хэдийн алдаагаар сонгогдсон учир сонгох боломжгүй! Тусламж цэснээс дэлгэрэнгүй танилцана уу!")}else if(l.hasClass("failure")){h=l.attr("id"),l.text();l.hasClass("basic")||l.hasClass("undevelop")?l.hasClass("undevelop")?(l.removeClass("failure"),e("#node_"+h).remove(),e("#tag_"+h).remove(),0==e(".node").length&&e('#log_type_id option[value="0"]').prop("selected",!0)):(n(l,c,h),l.removeClass("failure"),e("#node_"+h).remove(),e("#tag_"+h).remove()):1==t(h,c)?(n(l,c,h),l.removeClass("failure"),e("#node_"+h).remove(),e("#tag_"+h).remove()):alert("Энэ үйлдлийг хийхийг зөвшөөрөхгүй учир нь [basic] буюу эцсийн элемент дээр алдаа өгсөн учраас!")}else if(e(this).hasClass("basic")){var f=i(l.attr("id"),c,d);if("success"==f.status){r(l);var v=o(c,e(this));"true"==v.logic.result?e('#log_type_id option[value="1"]').prop("selected",!0):e('#log_type_id option[value="2"]').prop("selected",!0)}else alert("["+l.text()+"] энэ мөчрийн эх аль хэдийн алдаагаар сонгогдсон учир сонгох боломжгүй! \n Эхлээд тухайн алдаа гарсан эх мөчрийг сонголтгүй болго!")}else e(this).hasClass("undevelop")?(l.addClass("failure"),0==e(".node").length&&e('#log_type_id option[value="2"]').prop("selected",!0),r(e(this))):alert("Үндсэн болон тодорхой бус элэментийг сонгоно уу! Дэд хэсгийн сонгохгүй!")}),e("#reset").on("click",function(a){var s=e("#vw_loc_equip_id").val();e(".btn-tag").remove(),e(".tree li span").each(function(a){e(this).hasClass("failure")&&e(this).removeClass("failure")}),e("#create_form").length?e(".node").each(function(a){e(this).remove()}):e("#edit_form").length&&e(".node").each(function(a){e(this).remove()}),e('#log_type_id option[value="0"]').prop("selected",!0),e.ajax({type:"POST",url:base_url+"/index.php/flog/jx_reset/",data:{equipment_id:s,location_id:f},dataType:"json",async:!1,success:function(e){return"success"==e.status?(console.log("restor successed"),!0):(console.log("restor false"),!1)}})}),e(document).on("hover"," li > span.module",function(a){"mouseenter"!=a.type&&"mouseover"!=a.type||(e("."+s.mod_class).removeClass("current"),e("."+s.mod_class).removeClass("children"),e("."+s.mod_class).removeClass("parent"),e(this).addClass("current"),e(this).closest("li").children("ul").children("li").children("span.module").addClass("children"),e(this).closest("li").closest("ul").closest("li").children("span.module").addClass("parent"))}),this}}),e.treeview={};var a=e.treeview.classes={open:"open",closed:"closed",expandable:"expandable",expandableHitarea:"expandable-hitarea",lastExpandableHitarea:"lastExpandable-hitarea",collapsable:"collapsable",collapsableHitarea:"collapsable-hitarea",lastCollapsableHitarea:"lastCollapsable-hitarea",lastCollapsable:"lastCollapsable",lastExpandable:"lastExpandable",last:"last",hitarea:"hitarea"}}(jQuery);