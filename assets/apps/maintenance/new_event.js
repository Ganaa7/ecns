function createEvent(){rowdone.hide(),$("#rowDoneby").hide(),form.dialog("option","title","Шинэ бүртгэл үүсгэх"),"USER"!==role?form.dialog({buttons:[{text:"Хадгалах",click:function(){var e={},t=$('input[type="text"], input[type="hidden"], select, textarea',form);t.each(function(){var t=$(this);e[t.attr("name")]=t.val()}),$.ajax({type:"POST",url:base_url+"/maintenance/add",data:e,dataType:"json",success:function(e){"success"==e.status?(form.dialog("close"),$("#calendar").fullCalendar("refetchEvents"),showMessage(e.message,"success")):$("p.feedback",form).removeClass("success, notify").addClass("error").html(e.message).show()}})}},{text:"Болих",click:function(){$("#doneby_id").trigger("chosen:updated"),$(this).dialog("close")}}]}):form.dialog({buttons:[{text:"Болих",click:function(){$("#doneby_id").trigger("chosen:updated"),$(this).dialog("close")}}]}),form.dialog("open")}function clickEvent(e,t,a){switch(role){case"ENG":1==t&&0==a?(rowdone.show(),$("#rowDoneby").show(),allEnabled(),form.dialog("option","title","Үйл ажиллагаа гүйцэтгэх"),form.dialog({buttons:[{text:"Гүйцэтгэх",click:function(){data=getData(e),$.ajax({url:base_url+"/maintenance/done",data:data,type:"POST",dataType:"json",success:function(e){"success"==e.status?(form.dialog("close"),showMessage(e.message,"success"),$("#calendar").fullCalendar("refetchEvents")):$("p.feedback",form).removeClass("success, notify").addClass("error").html(e.message).show()}})}},{text:"Болих",click:function(){$("#doneby_id").trigger("chosen:updated"),$(this).dialog("close")}}]})):(form.dialog("option","title","Үйл ажиллагаа"),form.dialog({buttons:[{text:"Буцах",click:function(){$(this).dialog("close")}}]})),form.dialog("open");break;case"ENG_CHIEF":form.dialog("option","title","Үйл ажиллагаа"),1==t&&0==a?(rowdone.show(),$("#rowDoneby").show(),allEnabled(),form.dialog({buttons:[{text:"Засах",click:function(){data=getData(e),$.ajax({url:base_url+"/maintenance/edit",data:data,type:"POST",dataType:"json",success:function(e){"success"==e.status?(form.dialog("close"),showMessage(e.message,"success"),$("#calendar").fullCalendar("refetchEvents")):$("p.feedback",form).removeClass("success, notify").addClass("error").html(e.message).show()}})}},{text:"Гүйцэтгэх",click:function(){data=getData(e),$.ajax({url:base_url+"/maintenance/done",data:data,type:"POST",dataType:"json",success:function(e){"success"==e.status?(form.dialog("close"),showMessage(e.message,"success"),$("#calendar").fullCalendar("refetchEvents")):$("p.feedback",form).removeClass("success, notify").addClass("error").html(e.message).show()}})}},{text:"Болих",click:function(){$("#doneby_id").trigger("chosen:updated"),form.dialog("close")}}]})):form.dialog({buttons:[{text:"Засах",click:function(){data=getData(e),$.ajax({url:base_url+"/maintenance/edit",data:data,type:"POST",dataType:"json",success:function(e){"success"==e.status?(form.dialog("close"),showMessage(e.message,"success"),$("#calendar").fullCalendar("refetchEvents")):$("p.feedback",form).removeClass("success, notify").addClass("error").html(e.message).show()}})}},{text:"Болих",click:function(){$("#doneby_id").trigger("chosen:updated"),form.dialog("close")}}]}),form.dialog("open");break;case"CHIEF":form.dialog("option","title","Үйл ажиллагаа"),form.dialog({buttons:[{text:"Зөвшөөрөх",click:function(){data=getData(e),$.ajax({url:base_url+"/maintenance/authorize",data:data,type:"POST",dataType:"json",success:function(e){"success"==e.status?(form.dialog("close"),showMessage(e.message,"success"),$("#calendar").fullCalendar("refetchEvents")):$("p.feedback",form).removeClass("success, notify").addClass("error").html(e.message).show()}})}},{text:"Устгах",click:function(){data=getData(e),$.ajax({url:base_url+"/maintenance/delete",data:data,type:"POST",dataType:"json",success:function(e){"success"==e.status?(form.dialog("close"),showMessage(e.message,"success"),$("#calendar").fullCalendar("refetchEvents")):$("p.feedback",form).removeClass("success, notify").addClass("error").html(e.message).show()}})}},{text:"Засах",click:function(){data=getData(e),$.ajax({url:base_url+"/maintenance/edit",data:data,type:"POST",dataType:"json",success:function(e){"success"==e.status?(form.dialog("close"),showMessage(e.message,"success"),$("#calendar").fullCalendar("refetchEvents")):$("p.feedback",form).removeClass("success, notify").addClass("error").html(e.message).show()}})}},{text:"Болих",click:function(){$("#doneby_id").trigger("chosen:updated"),form.dialog("close")}}]}),form.dialog("open");break;default:form.dialog("option","title","Үйл ажиллагаа"),form.dialog({buttons:[{text:"Буцах",click:function(){form.dialog("close")}}]}),form.dialog("open")}}function moveEvent(e,t,a,n){$.ajax({url:base_url+"/maintenance/move",data:"start="+e+"&end="+t+"&id="+a+"&action="+n,type:"POST",dataType:"json",success:function(e){"success"==e.status?showMessage(e.message,"success"):showMessage(e.message,"error")}})}function allDisabled(){var e=$('input[type="text"], input[type="hidden"], select, textarea',form);e.each(function(){var e=$(this);e.prop("disabled","disabled")})}function allEnabled(){var e=$('input[type="text"], input[type="hidden"], select, textarea',form);e.each(function(){var e=$(this);e.prop("disabled",!1)})}function getData(e){var t={},a=$('input[type="text"], input[type="hidden"], select, textarea',form);return a.each(function(){var e=$(this);t[e.attr("name")]=e.val()}),t.eventId=e,t.done=$("#done").val(),t}function showMessage(e,t){$("p#notification").length||$("#nav-bar").prepend('<p id="notification"></p>');var a=$("p#notification");a.hide(),a.removeClass(),a.addClass(t),a.html(e),a.fadeIn("fast",function(){a.delay(5e3).fadeOut()})}function filter(e,t,a){$.post(base_url+"/maintenance/filter",{id:t},function(t){var n=$("#"+a+"_id",e);if(n.prop)var o=n.prop("options");else o=n.attr("options");$("option",n).remove(),$.each(t,function(e,t){o[o.length]=new Option(t,e)})})}function gen_option(e,t){var a=$("#equipment_id",t);if(a.prop)var n=a.prop("options");else n=a.attr("options");$("option",a).remove(),a.append(new Option("Нэг тоног төхөөрөмж сонго",0)),$.each(e,function(e,t){n[n.length]=new Option(t,e)})}$(document).ready(function(){$("#doneby_id").chosen({no_results_text:"Oops, nothing found!"}),$(".chosen-container ").css("width","250px"),$("#location_id","#event_form").change(function(){filter("#event_form",$(this).val(),"equipment")}),form=$("#event_form"),rowdone=$("#trdone"),role=$("#role").val(),eventtypeId=$("#eventtype_id"),equipmentId=$("#equipment_id"),locationId=$("#location_id"),event=$('input[name="event"]'),done=$("#done"),form.dialog({width:640,autoOpen:!1,resizable:!1,modal:!0,close:function(){$("p.feedback",form).html("").hide(),$('input[type="text"], input[type="hidden"], textarea, select',form).val(""),$("#eventId").text("")}}),$("#startdate").datetimepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0}),$("#enddate").datetimepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0});var e=$("#calendar").fullCalendar({columnFormat:{month:"dddd",week:"ddd-d",day:""},axisFormat:"H:mm",timeFormat:{"":"H:mm",agenda:"H:mm{ - H:mm}"},buttonText:{today:"Өнөөдөр",month:"Сар",day:"Өдөр",week:"7 хоног"},monthNames:["I сар","II сар","III сар","IV сар","V сар","VI сар","VII сар","VIII сар","IX сар","X сар","XI сар","XII сар"],monthNamesShort:["I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII"],dayNames:["Ням","Даваа","Мягмар","Лхагва","Пүрэв","Баасан","Бямба"],dayNamesShort:["Ня","Да","Мя","Лх","Пү","Ба","Бя"],header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},events:{url:base_url+"/maintenance/get_event",cache:!0},eventColor:"#FFD900",eventTextColor:"#000000",eventborderColor:"red",selectable:!0,selectHelper:!0,editable:!0,eventDrop:function(e,t){var a=$.fullCalendar.formatDate(e.start,"yyyy-MM-dd HH:mm:ss"),n=$.fullCalendar.formatDate(e.end,"yyyy-MM-dd HH:mm:ss");moveEvent(a,n,e.id,"move")},eventResize:function(e){start=$.fullCalendar.formatDate(e.start,"yyyy-MM-dd HH:mm:ss"),end=$.fullCalendar.formatDate(e.end,"yyyy-MM-dd HH:mm:ss"),moveEvent(start,end,e.id,"resize")},select:function(t,a,n){createEvent(),$("#createdbyId").text(""),$("#startdate").val($.fullCalendar.formatDate(t,"yyyy-MM-dd HH:mm")),$("#enddate").val($.fullCalendar.formatDate(a,"yyyy-MM-dd HH:mm")),e.fullCalendar("unselect"),$("#calendar").fullCalendar("refetchEvents")},eventClick:function(e,t,a){$.post(base_url+"/maintenance/get_event_dtl",{id:e.id},function(t){$("#eventId").text(e.id),$("#event").val(t.title),$("#is_interrupt").val(t.is_interrupt).change();var a=t.itas;t.isdone&&$.each(a,function(e,t){$("#doneby_id option[value="+e+"]").attr("selected","selected")}),null!==t.createdby?$("#createdbyId").text(t.createdby):$("#createdbyId").text(""),eventtypeId.val(t.eventtype_id),gen_option(t.equipments,"#event_form"),equipmentId.val(t.equipment_id),locationId.val(t.location_id),null!==t.done&&""!==t.done?(done.val(t.done),$("#doneby_id option[value="+t.doneby_id+"]").attr("selected","selected"),$("#rowDoneby").show(),$("#trdone").show()):$("#trdone").hide(),$("#startdate").val(dateFormat(t.start,"yyyy-mm-dd HH:MM")),$("#enddate").val(dateFormat(t.end,"yyyy-mm-dd HH:MM")),$("#doneby_id").trigger("chosen:updated"),clickEvent(e.id,t.active,t.isdone)}),$(this).css("border-color","red")}})});var dateFormat=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,a=/[^-+\dA-Z]/g,n=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e};return function(o,s,d){var r=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(o)||/\d/.test(o)||(s=o,o=void 0),o=o?new Date(o):new Date,isNaN(o))throw SyntaxError("invalid date");s=String(r.masks[s]||s||r.masks.default),"UTC:"==s.slice(0,4)&&(s=s.slice(4),d=!0);var i=d?"getUTC":"get",c=o[i+"Date"](),l=o[i+"Day"](),m=o[i+"Month"](),u=o[i+"FullYear"](),f=o[i+"Hours"](),y=o[i+"Minutes"](),h=o[i+"Seconds"](),p=o[i+"Milliseconds"](),g=d?0:o.getTimezoneOffset(),$={d:c,dd:n(c),ddd:r.i18n.dayNames[l],dddd:r.i18n.dayNames[l+7],m:m+1,mm:n(m+1),mmm:r.i18n.monthNames[m],mmmm:r.i18n.monthNames[m+12],yy:String(u).slice(2),yyyy:u,h:f%12||12,hh:n(f%12||12),H:f,HH:n(f),M:y,MM:n(y),s:h,ss:n(h),l:n(p,3),L:n(p>99?Math.round(p/10):p),t:f<12?"a":"p",tt:f<12?"am":"pm",T:f<12?"A":"P",TT:f<12?"AM":"PM",Z:d?"UTC":(String(o).match(t)||[""]).pop().replace(a,""),o:(g>0?"-":"+")+n(100*Math.floor(Math.abs(g)/60)+Math.abs(g)%60,4),S:["th","st","nd","rd"][c%10>3?0:(c%100-c%10!=10)*c%10]};return s.replace(e,function(e){return e in $?$[e]:e.slice(1,e.length-1)})}}();dateFormat.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(e,t){return dateFormat(this,e,t)};