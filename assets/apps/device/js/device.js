function jqgrid(){$("#grid").jqGrid({url:base_url+"/equipment/index/grid",datatype:"json",mtype:"GET",colNames:["#","Хэсэг","Пассорт №","Төхөөрөмж","Гэрчилгээ №","Байршил","Марк, төрөл","Парт №","Ашиглалтад орсон он"],colModel:[{name:"id",index:"device.id",width:15,align:"center"},{name:"section",index:"section.name",width:60,align:"center",formatter:view_link,stype:"select",searchoptions:{value:set_section()}},{name:"passport_no",index:"passport_no",width:60,align:"center"},{name:"device",index:"device",width:120,formatter:view_link},{name:"cert_no",index:"cert_no",width:60,align:"center"},{name:"location",index:"location.location",width:50,align:"center"},{name:"mark",index:"mark",width:60,align:"center",formatter:view_link},{name:"part_number",index:"part_number",width:60,align:"center",formatter:view_link},{name:"year_init",index:"year_init",width:60,align:"center"}],jsonReader:{page:"page",total:"total",records:"records",root:"rows",repeatitems:!1,id:"id"},pager:"#pager",rowNum:20,rowList:[10,20,30,40],sortname:"device.id",sortorder:"asc",viewrecords:!0,gridview:!0,caption:"Тоног төхөөрөмжийн пасспорт",autowidth:!0,height:500,width:"100%",editurl:"server.php",subGrid:!1,loadComplete:function(){for(var e=$(this).jqGrid("getDataIDs"),a=0;a<e.length;a++){$("#grid").jqGrid("getRowData",e[a]);var t=jQuery("#"+e[a],jQuery("#grid"));t.addClass("context-menu")}}}),jQuery("#grid").jqGrid("filterToolbar",{stringResult:!0,searchOnEnter:!1})}function set_section(){var e="";return $("#section_id option").each(function(){e=$(this).text()+":"+$(this).text(),0}),e=":Бүгд;Холбоо:Холбоо;Навигаци:Навигаци;Ажиглалт:Ажиглалт;Гэрэл суулт, цахилгаан:ГСЦ;ЧОУНБХ (NUBIA):ЧОУНБХ (NUBIA)",e}function pass_modal(e,a){$("input[name=equipment_id]",pass).val(e),$.ajax({type:"POST",url:base_url+"/equipment/index/get/",data:{id:e},dataType:"json",success:function(e){if($("input[name=device_id]",pass).val(e.id),$("#location_id option[value="+e.location.location_id+"]",pass).attr("selected","selected"),$("#section_id option[value="+e.section_id+"]",pass).attr("selected","selected"),$("#equipment_id option[value="+e.equipment.equipment_id+"]",pass).attr("selected","selected"),e.passport_no){var a=confirm("Пасспортын дугаар аль хэдийн олгосон байна! Шинээр олгох уу?");1==a?$("#passport_no",pass).val(e.pass_no):$("#passport_no",pass).val(e.passport_no)}else $("#passport_no",pass).val(e.pass_no)}}).done(function(){pass.dialog({title:"Төхөөрөмжийн пасспортын дугаар олгох : ",buttons:{"Хадгалах":function(){var e=$("#pass").serialize();$.ajax({type:"POST",url:base_url+"/equipment/index/set_pass",data:e,dataType:"json",async:!1,success:function(e){"success"==e.status?(pass.dialog("close"),showMessage(e.message,"success"),jQuery("#grid").jqGrid("setGridParam",{datatype:"json"}).trigger("reloadGrid")):$("p.feedback",pass).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){pass.dialog("close")}}}),pass.dialog("open")})}function view_modal(e){var a;$.ajax({type:"POST",url:base_url+"/equipment/index/get/",data:{id:e},dataType:"json",success:function(e){$("#id",view).val(e.id),$("#section_id option[value="+e.section_id+"]",view).attr("selected","selected"),$("#sector_id option[value="+e.sector_id+"]",view).attr("selected","selected"),$("#equipment",view).val(e.equipment),$("#code",view).val(e.code),$("#intend",view).val(e.intend),$("#spec",view).val(e.spec),$("#year_init",view).val(e.year_init),$("input[name=sp_id]",view).val(e.sp_id),a=e.equipment}}).done(function(){view.dialog({title:"Төхөөрөмж: ["+a+"]",buttons:{"Хаах":function(){view.dialog("close")}}}),view.dialog("open")})}function filter(e,a,t){var i={};i="equipment"==t?{id:a,target:t,section:$("#section_id").val()}:{id:a,target:t},$.post(base_url+"/equipment/index/filterby",i,function(a){var i=$("#"+t+"_id",e);if(i.prop)var s=i.prop("options");else s=i.attr("options");$("option",i).remove(),$.each(a,function(e,a){s[s.length]=new Option(a,e)})})}function maintenance_modal(e,a){$.ajax({type:"POST",url:base_url+"/equipment/index/get_passbook/",data:{id:a},dataType:"json",success:function(e){var a=Object.keys(e.detail);a>1&&$("#add_passbook_all").hide()}}).done(function(){maintenance.dialog({title:"Техник үйлчилгээ, үзлэгийн бүртгэл:  "+e,buttons:{"Хадгалах":function(){var e=$("#maintenance").serialize();$.ajax({type:"POST",url:base_url+"/equipment/index/add_maintenance",data:e+"&passbook_id="+a,dataType:"json",async:!1,success:function(e){"success"==e.status?(maintenance.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)):$("p.feedback",maintenance).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){maintenance.dialog("close")}}}),maintenance.dialog("open")})}function view_link(e,a,t){return"<a  href='"+base_url+"/equipment/view/"+t.id+"'>"+e+"</a>"}function material_modal(e,a){material.dialog({title:"Шинэ:  "+e,buttons:{"Хадгалах":function(){var e=$("#material").serialize();$.ajax({type:"POST",url:base_url+"/equipment/index/add_material",data:e+"&passbook_id="+a,dataType:"json",async:!1,success:function(e){"success"==e.status?(material.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e4)):$("p.feedback",material).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){material.dialog("close")}}}),material.dialog("open")}function edit_material_(e){$("input[name=id]",edit_material).val(e),$.ajax({type:"POST",url:base_url+"/equipment/index/get_material/",data:{id:e},dataType:"json",success:function(e){$("#device",edit_material).val(e.device.device),$("#materials",edit_material).val(e.materials),$("#qty",edit_material).val(e.qty),$("#part_number",edit_material).val(e.part_number)}}).done(function(){edit_material.dialog({title:"Эд болгогч зүйлсийг засварлах",buttons:{"Хадгалах":function(){var e=$("#edit_material").serialize();$.ajax({type:"POST",url:base_url+"/equipment/index/edit_material",data:e,dataType:"json",async:!1,success:function(e){"success"==e.status?(edit_material.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)):$("p.feedback",edit_material).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){edit_material.dialog("close")}}}),edit_material.dialog("open")})}function delete_material(e){confirm=window.confirm("Энэ иж болгогч зүйлсийг устгахдаа итгэлтэй байна уу?"),confirm&&$.ajax({type:"POST",url:base_url+"/equipment/index/del_material/",data:{id:e},dataType:"json",success:function(e){showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)}})}function delete_parameter(e){confirm=window.confirm("Энэ үзүүлэлтийн устгахдаа итгэлтэй байна уу?"),confirm&&$.ajax({type:"POST",url:base_url+"/equipment/index/del_parameter/",data:{id:e},dataType:"json",success:function(e){showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)}})}function parameter_modal(e,a){parameter.dialog({title:e,buttons:{"Хадгалах":function(){var e=$("#parameter").serialize();$.ajax({type:"POST",url:base_url+"/equipment/index/add_parameter",data:e+"&passbook_id="+a,dataType:"json",async:!1,success:function(e){"success"==e.status?(parameter.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)):$("p.feedback",parameter).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){parameter.dialog("close")}}}),parameter.dialog("open")}function edit_parameter_(e){$("input[name=id]",edit_parameter).val(e),$.ajax({type:"POST",url:base_url+"/equipment/index/get_parameter/",data:{id:e},dataType:"json",success:function(e){$("#device",edit_parameter).val(e.device.device),$("#parameters",edit_parameter).val(e.parameters),$("#measure",edit_parameter).val(e.measure),$("#value",edit_parameter).val(e.value)}}).done(function(){edit_parameter.dialog({title:"Үзүүлэлтийг  засварлах",buttons:{"Хадгалах":function(){var e=$("#edit_parameter").serialize();$.ajax({type:"POST",url:base_url+"/equipment/index/edit_parameter",data:e,dataType:"json",async:!1,success:function(e){"success"==e.status?(edit_parameter.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)):$("p.feedback",edit_parameter).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){edit_parameter.dialog("close")}}}),edit_parameter.dialog("open")})}function repair_modal(e,a,t){$("#device_id",repair).val(t),repair.dialog({title:e,buttons:{"Хадгалах":function(){var e=$("#repair").serialize();$.ajax({type:"POST",url:base_url+"/equipment/index/add_repair",data:e+"&passbook_id="+a,dataType:"json",async:!1,success:function(e){"success"==e.status?(repair.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)):$("p.feedback",repair).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){$("#repairedby_id").val("").trigger("chosen:updated"),repair.dialog("close")}}}),repair.dialog("open")}function edit_repair_(e,a){var t;$("#repair_id",edit_repair).val(e),$.ajax({type:"POST",url:base_url+"/equipment/index/get_repair/",data:{id:e},dataType:"json",success:function(e){$("#edit_repair_date",edit_repair).val(e.repair_date),$('#spare_id option[value="'+e.spare_id+'"]',edit_repair).attr("selected",!0),$("#reason",edit_repair).val(e.reason),$("#repair",edit_repair).val(e.repair),$("#qty",edit_repair).val(e.qty),$("#part_number",edit_repair).val(e.part_number),$("#duration",edit_repair).val(e.new_duration),$('#edit_repairedby_id option[value="'+e.repairedby_id+'"]',edit_repair).attr("selected",!0),t=e.itas,e.isdone&&$.each(t,function(e,a){$("#edit_repairedby_id option[value="+e+"]",edit_repair).attr("selected","selected")}),console.log("test"+e.no_spare),"0"!==e.no_spare||null===e.no_spare?($("#edit_no_spare").prop("checked",!0),$("#edit_btn_spare").attr("disabled",!0)):$.each(e.spare,function(e,a){$("#edit_spare_table").append("<tr class='remove_tr' id='spare_"+a.id+"'><td>"+a.id+"</td><td><input type='hidden' name='spare_id[]' value='"+a.spare_id+"'> "+a.spare+"</td><td><input type='hidden' name='qty[]' value='"+a.qty+"'> "+a.qty+"</td><td><input type='hidden' name='part_number[]' value='"+a.part_number+"'>"+a.part_number+"</td><td><a href='#' data-id='"+a.id+"' id='spare_row_delete'>Устгах</a></td></tr>")}),$("#edit_repairedby_id").trigger("chosen:updated")}}).done(function(){edit_repair.dialog({title:"Эд болгогч зүйлсийг засварлах",buttons:{"Хадгалах":function(){var e=$("#edit_repair").serialize();$.ajax({type:"POST",url:base_url+"/equipment/index/edit_repair",data:e+"&passbook_id="+a,dataType:"json",async:!1,success:function(e){"success"==e.status?(edit_repair.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)):$("p.feedback",edit_repair).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){$(".remove_tr").remove(),edit_repair.dialog("close")}}}),edit_repair.dialog("open")})}function delete_repair(e){confirm=window.confirm("Энэ засварыг устгахдаа итгэлтэй байна уу?"),confirm&&$.ajax({type:"POST",url:base_url+"/equipment/index/del_repair/",data:{id:e},dataType:"json",success:function(e){showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)}})}function _edit_maintenance(e,a){var t;$.ajax({type:"POST",url:base_url+"/equipment/index/get_passbook/",data:{id:a},dataType:"json",success:function(e){var a=Object.keys(e.detail);a>1&&$("#edit_passbook_all").hide()}}),$("input[name=id]",edit_maintenance).val(e),$.ajax({type:"POST",url:base_url+"/maintenance/get_event_dtl/",data:{id:e},dataType:"json",success:function(e){t=e.itas,null===e.passbook_id&&$("#passbook_all_edit").attr("checked",!0),$("#equipment_id",edit_maintenance).val(e.equipment_id),$("#location_id",edit_maintenance).val(e.location_id),$("#eventtype_id",edit_maintenance).val(e.eventtype_id),$("#event",edit_maintenance).val(e.title),$("#is_interrupt",edit_maintenance).val(e.is_interrupt),$("#startdate_edit",edit_maintenance).val(e.start.substring(e.start.lenght,16)),$("#enddate",edit_maintenance).val(e.end.substring(e.end.lenght,16)),$("#done",edit_maintenance).val(e.done),$("#doneby_id",edit_maintenance).val(e.doneby_id),$("#createdby",edit_maintenance).val(e.createdby),e.isdone&&$.each(t,function(e,a){$("#doneby_ita_id option[value="+e+"]",edit_maintenance).attr("selected","selected")}),$("#doneby_ita_id").chosen({no_results_text:"Oops, nothing found!"}),$(".chosen-container ").css("width","250px"),$("#doneby_ita_id").trigger("chosen:updated")}}).done(function(){edit_maintenance.dialog({title:"Эд болгогч зүйлсийг засварлах",buttons:{"Хадгалах":function(){var e=$("#edit_maintenance").serialize();$.ajax({type:"POST",url:base_url+"/equipment/index/edit_maintenance",data:e+"&passbook_id="+a,dataType:"json",async:!1,success:function(e){"success"==e.status?(edit_maintenance.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},5e3)):$("p.feedback",edit_maintenance).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){edit_maintenance.dialog("close")}}}),edit_maintenance.dialog("open")})}function delete_maintenance(e){confirm=window.confirm("Энэ техник үйлчилгээг устгахадаа итгэлтэй байна уу? Энэ мэдээлэлийг устгавал Техник үйлчилгээ модулиас давхар устгагдах болно?"),confirm&&$.ajax({type:"POST",url:base_url+"/equipment/index/del_maintenance/",data:{id:e},dataType:"json",success:function(e){showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)}})}function add_passbook(e,a){$("#passbook")[0].reset(),passbook.dialog({title:"Техникийн пасспортын дэд хэсэг:",buttons:{"Хадгалах":function(){var e=$("#passbook").serialize();$.ajax({type:"POST",url:base_url+"/equipment/index/add_passbook",data:e,dataType:"json",async:!1,success:function(e){"success"==e.status?(passbook.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)):$("p.feedback",passbook).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){passbook.dialog("close")}}}),$("#node_id").multiselect(),passbook.dialog("open")}function edit_passbook(e){$("#passbook")[0].reset();var a=[];$.ajax({type:"POST",url:base_url+"/equipment/index/get_passbook/",data:{id:e},dataType:"json",success:function(e){a=e.detail,$("#passbook_no",passbook).val(e.passbook_no),$.each(a,function(e,a){$("#node_id option[value="+e+"]",passbook).attr("selected","selected")}),$("#node_id").multiselect()}}).done(function(){passbook.dialog({title:"Техникийн пасспортын дэд хэсэг:",buttons:{"Хадгалах":function(){var a=$("#passbook").serialize();$.ajax({type:"POST",url:base_url+"/equipment/index/edit_passbook/",data:a+"&passbook_id="+e,dataType:"json",async:!1,success:function(e){"success"==e.status?(passbook.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},2e3)):$("p.feedback",passbook).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){passbook.dialog("close")}}}),passbook.dialog("open")})}function delete_passbook(e){var a=confirm("Энэ пасспортын хэсгийн мэдээллийг устгах уу? Хэрэв устгагдвал тухайн төхөөрөмжийн техник үйлчилгээ харагдахгүй болохыг анхаарна уу!");a&&$.ajax({type:"POST",url:base_url+"/equipment/index/delete_passbook",data:{id:e},dataType:"json",async:!1,success:function(e){"success"==e.status?(showMessage(e.message,"success"),setTimeout(function(){location.reload()},5e3)):showMessage(e.message,"error")}})}function maintenance_load(e,a,t){maintenance_load_id.dialog({title:"Техник үйлчилгээний дэвтэр:",buttons:{"Хадгалах":function(){var e=$("#maintenance_load_id").serialize();$.ajax({type:"POST",url:base_url+"/equipment/index/add_passbook_events",data:e+"&passbook_id="+t,dataType:"json",async:!1,success:function(e){"success"==e.status?(maintenance_load_id.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)):$("p.feedback",passbook).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){maintenance_load_id.dialog("close")}}}),maintenance_load_id.dialog("open")}function add_spare(){spare.dialog("open")}function add_spare_edit(){add_spare_edit_dialog.dialog("open")}function spare_row_delete(e){$("#tr_id_"+e,"#spare_table").remove(),counter--}function add_repair_model(e,a,t){repair_load.dialog({title:"Гэмтэл дутагдлын бүртгэл:Засварласан гэмтлүүд",buttons:{"Хадгалах":function(){var e=$("#repair_load").serialize();$.ajax({type:"POST",url:base_url+"/equipment/index/add_repair_load",data:e+"&passbook_id="+t,dataType:"json",async:!1,success:function(e){"success"==e.status?(repair_load.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)):$("p.feedback",passbook).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){repair_load.dialog("close")}}}),repair_load.dialog("open")}function add_new_spare(e){null!=$("#sp_id").val()?new_spare.dialog("open"):alert("Энэ төхөөрөмж дээр сэлбэгийн дугаарыг өгөөгүй байгаа тул шинэ сэлбэг нэмэх боломжгүй байна!")}var add,pass,view,material,parameter,repair,edit_parameter,edit_repair,maintenance,edit_maintenance,passbook,maintenance_load_id,repair_load,spare,new_spare,add_spare_edit_dialog,counter=0;$(document).on("click","#spare_row_delete",function(){var e=$(this).attr("data-id");$("#spare_"+e).remove()}),$(document).ready(function(){$("#tabs").tabs(),$("#no_spare").on("click",function(){$("#btn_spare").is(":disabled")?$("#btn_spare").removeAttr("disabled"):$("#btn_spare").attr("disabled",!0)}),$("#edit_no_spare").on("click",function(){$("#edit_btn_spare").is(":disabled")?$("#edit_btn_spare").removeAttr("disabled"):$("#edit_btn_spare").attr("disabled",!0)}),$("#repairedby_id").length&&$("#repairedby_id").chosen({no_results_text:"Oops, nothing found!"}),$("#edit_repairedby_id").length&&$("#edit_repairedby_id").chosen({no_results_text:"Oops, nothing found!"}),$("#doneby_id").length&&$("#doneby_id").chosen({no_results_text:"Oops, nothing found!"}),$("#edit_location_id").length&&$("#edit_location_id").chosen({no_results_text:"Утга олдсонгүй!"}),$("#spare_id_add_list").lenght&&$("#spare_id_add_list").chosen({no_results_text:"Утга олдсонгүй!"}),$("#spare_id").lenght&&$("#spare_id").chosen({no_results_text:"Утга олдсонгүй!"}),$("#no_cert_no").hide(),$("#certificate_id").show(),$("#year_init").datepicker({dateFormat:"yy",changeYear:!0,showWeek:!0,opened:!1}),$("#year_init","#edit_pass").datepicker({dateFormat:"yy",changeYear:!0,showWeek:!0,opened:!1}),$("#factory_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,changeYear:!0,yearRange:"1990:2020",showWeek:!0,opened:!1}),$("#order_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"1990:2020",showOtherMonths:!0,changeYear:!0,showWeek:!0,opened:!1}),$("#startdate").datetimepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0,changeYear:!0,yearRange:"1990:2020"}),$("#startdate_edit").datetimepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0,changeYear:!0,yearRange:"1990:2020"}),$("#enddate").datetimepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0,changeYear:!0,yearRange:"1990:2020"}),$("#repair_date","#repair").datepicker({dateFormat:"yy-mm-dd",changeYear:!0,showWeek:!0,opened:!1,changeYear:!0,yearRange:"1990:2020"}),$("#duration").timepicker({hourMin:0,hourMax:96}),$("#edit_repair_date","#edit_repair").datepicker({dateFormat:"yy-mm-dd",changeYear:!0,showWeek:!0,opened:!1,yearRange:"1990:2020"}),$("#duration","#edit_repair").timepicker({hourMin:0,hourMax:72}),$("#eventtype_id").change(function(){$("#event").text($("#eventtype_id option:selected").text())}),jqgrid(),maintenance_load_id=$("#maintenance_load_id"),maintenance_load_id.dialog({autoOpen:!1,width:800,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"],  select, textarea',$(this)).val(""),$(this).dialog("close")}}),passbook=$("#passbook"),passbook.dialog({autoOpen:!1,width:600,resizable:!1,modal:!0,close:function(){$("#node_id option:selected").removeAttr("selected"),$("p.feedback",$(this)).html("").hide(),$('input[type="text"],  select, textarea',$(this)).val(""),$(this).dialog("close"),$("#node_id").multiselect("destroy")}}),material=$("#material"),material.dialog({autoOpen:!1,width:600,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"],  select, textarea',$(this)).val(""),$(this).dialog("close")}}),maintenance=$("#maintenance"),maintenance.dialog({autoOpen:!1,width:600,resizable:!1,modal:!0,buttons:{"Хаах":function(){$("#doneby_id").val("").trigger("chosen:updated"),maintenance.dialog("close")}},close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"], select, textarea',$(this)).val(""),$(this).dialog("close")}}),edit_maintenance=$("#edit_maintenance"),edit_maintenance.dialog({autoOpen:!1,width:600,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"], select, textarea, input[type="file"]',$(this)).val(""),$("#passbook_all_edit").attr("checked",!1),$(this).dialog("close")}}),parameter=$("#parameter"),parameter.dialog({autoOpen:!1,width:600,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"], select, textarea, input[type="file"]',$(this)).val(""),$(this).dialog("close")}}),repair=$("#repair"),repair.dialog({autoOpen:!1,width:800,height:500,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"], select, textarea, input[type="file"]',$(this)).val(""),$("#file_link",$(this)).remove(),$(".remove_tr","#repair").remove(),$(this).dialog("close")}}),pass=$("#pass"),pass.dialog({autoOpen:!1,width:600,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"], select, textarea, input[type="file"]',$(this)).val(""),$("#file_link",$(this)).remove(),$(this).dialog("close")}}),view=$("#view"),view.dialog({autoOpen:!1,width:600,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"], select, textarea, input[type="file"]',$(this)).val(""),$("#file_link",$(this)).remove(),$(this).dialog("close")}}),edit_parameter=$("#edit_parameter"),edit_parameter.dialog({autoOpen:!1,width:600,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"],  select, textarea, input[type="file"]',$(this)).val(""),$(this).dialog("close")}}),edit_material=$("#edit_material"),edit_material.dialog({autoOpen:!1,width:600,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"], select, textarea, input[type="file"]',$(this)).val(""),$(this).dialog("close")}}),edit_repair=$("#edit_repair"),edit_repair.dialog({autoOpen:!1,width:800,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"],  select, textarea, input[type="file"]',$(this)).val(""),$("#edit_no_spare").prop("checked",!1),$(".remove_tr").empty(),$(this).dialog("close")}}),spare=$("#spare"),spare.dialog({autoOpen:!1,width:740,resizable:!1,modal:!0,buttons:{"Нэмэх":function(){var e=!0,a=$("#spare_id option:selected",t).val(),t=$("#spare_id option:selected",t).text(),i=$("#qty_spare").val(),s=$("#part_number_spare").val();if(counter++,a&&$.isNumeric(i)&&s){var n="<tr class='remove_tr' id='spare_"+a+"'><td>"+counter+"</td><td><input type='hidden' name='spare_id[]' value='"+a+"' />"+t;n=n+"</td><td><input type='hidden' name='qty[]' value='"+i+"' />"+i,n=n+"</td><td><input type='hidden' name='part_number[]' value='"+s+"' />"+s+"</td>",n=n+"<td><a href='#' onclick='spare_row_delete("+counter+")'>Устгах</a></td>",$("#spare_table").append(n+"</tr>"),$("p.feedback",repair).addClass("success").html("Материалын жагсаалтад амжилттай нэмэгдлээ").show(),$(this).dialog("close"),$("#spare")[0].reset()}else alert("Сэлбэгийн утгуудыг [Сэлбэг, Тоо/ш, үйлдвэрийн дугаар] бүгдийг сонгосон байх ёстой! Мөн тоо/ш зөвхөн тоо байх ёстойг анхаарна уу!");return e},"Болих":function(){$("#spare")[0].reset(),$("p.feedback",$(this)).html("").hide(),$('input[type="text"],  select, textarea',$(this)).val(""),$(this).dialog("close")}}}),add_spare_edit_dialog=$("#spare_edit_list"),add_spare_edit_dialog.dialog({autoOpen:!1,width:740,resizable:!1,modal:!0,buttons:{"Нэмэх":function(){var e=!0,a=$("#spare_id_add_list option:selected",add_spare_edit).val(),t=$("#spare_id_add_list option:selected",add_spare_edit).text(),i=$("#qty_spare_add_list").val(),s=$("#part_number_spare_add_list").val();if(counter++,a&&$.isNumeric(i)&&s){var n="<tr class='remove_tr' id='spare_"+a+"'><td>"+counter+"</td><td><input type='hidden' name='spare_id[]' value='"+a+"' />"+t;n=n+"</td><td><input type='hidden' name='qty[]' value='"+i+"' />"+i,n=n+"</td><td><input type='hidden' name='part_number[]' value='"+s+"' />"+s+"</td>",n=n+"<td><a href='#' id='spare_row_delete' data-id='"+a+"'>Устгах</a></td>",$("#edit_spare_table").append(n+"</tr>"),$("p.feedback",repair).addClass("success").html("Материалын жагсаалтад амжилттай нэмэгдлээ").show(),$(this).dialog("close"),$("#spare")[0].reset()}else alert("Сэлбэгийн утгуудыг [Сэлбэг, Тоо/ш, үйлдвэрийн дугаар] бүгдийг сонгосон байх ёстой! Мөн тоо/ш зөвхөн тоо байх ёстойг анхаарна уу!");return e},"Болих":function(){$("#spare")[0].reset(),$("p.feedback",$(this)).html("").hide(),$('input[type="text"],  select, textarea',$(this)).val(""),$(this).dialog("close")}}}),repair_load=$("#repair_load"),repair_load.dialog({autoOpen:!1,width:800,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"],  select, textarea',$(this)).val(""),$(this).dialog("close")}}),new_spare=$("#new-form"),new_spare.dialog({autoOpen:!1,width:570,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"], select, textarea',new_spare).val(""),$(this).dialog("close")},buttons:{"Хадгалах":function(){var e=$("#new-form").serialize(),a=$("#new_spare",new_spare).val();$.ajax({type:"POST",url:base_url+"/wh_settings/spare/add/",data:e,dataType:"json",async:!1,success:function(e){"success"==e.status?($("#spare_id").append($("<option>",{value:e.spare_id,text:a})),alert("Сэлбэгийн жагсаалтад амжжилттай нэмэгдлээ"),new_spare.dialog("close")):$("p.feedback",new_spare).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Болих":function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"],  select, textarea',$(this)).val(""),$(this).dialog("close")}}}),$("#section_id","#create_pass").change(function(){$("#location_id").prop("disabled",!1),$("#equipment_id").prop("disabled",!1),$("#label_section").text($("#section_id option:selected").text()+"-н хэсэг")}),$("#section_id","#edit_pass").change(function(){filter("#edit_pass",$(this).val(),"equipment"),$("#label_section").text($("#section_id option:selected").text()+"-н хэсэг")}),$("#location_id","#create_pass").change(function(){filter("#create_pass",$(this).val(),"equipment")}),$("#equipment_id","#create_pass, #edit_pass").change(function(){var e={location_id:$("#location_id option:selected").val(),equipment_id:$(this).val()};$.post(base_url+"/equipment/index/get_cert",e,function(e){if($("#certificate","#create_pass, #edit_pass").val(e.certificate.cert_no),console.log("certificate"+JSON.stringify(e.certificate)),console.log("count"+e.certificate.length),e.certificate.length){console.log("certificate_wrap"+e.certificate),$("#no_cert_no").hide(),$("#certificate_id").find("option").remove();var a=$("#certificate_id");if(a.prop)var t=a.prop("options");else t=a.attr("options");$.each(e.certificate,function(e,a){t[t.length]=new Option(a.cert_no,a.id)}),$("#certificate_id").show()}else $("#certificate_id").empty(),$("#certificate","#create_pass, #edit_pass").val("Гэрчилгээ байхгүй байна!"),$("#certificate","#create_pass, #edit_pass").prop("disabled",!1),$("#no_cert_no").show(),$('option[value="0"]',"#certificate_id").remove();$("#serial_number","#create_pass, #edit_pass").val(e.certificate.serial_no_year),$("input[name='device']","#create_pass, #edit_pass").val(e.equipment.equipment),$("#intend","#create_pass, #edit_pass").val(e.equipment.intend)})}),$("#cert_null","#create_pass, #edit_pass").on("click",function(){var e=0!=$("#certificate_id option[value='0']").length;0==e&&$("#certificate_id").append('<option value="0">Гэрчилгээгүй</option>'),$("#certificate","#create_pass, #edit_pass").val("0")}),$("#save","#create_pass").on("click",function(){var e=$("#create_pass").serialize();$.ajax({type:"POST",url:base_url+"/equipment/index/add",data:e,dataType:"json",async:!1,success:function(e){"success"==e.status?(showMessage(e.message,"success"),setTimeout(function(){window.location.assign(base_url+"/equipment")},3e3)):$("p.feedback","#create_pass").removeClass("success, notify").addClass("error").html(e.message).show()}})}),$("#update","#edit_pass").on("click",function(){var e=$("#edit_pass").serialize();$.ajax({type:"POST",url:base_url+"/equipment/index/update_passport",data:e,dataType:"json",async:!1,success:function(e){"success"==e.status?(showMessage(e.message,"success"),setTimeout(function(){window.location.assign(base_url+"/equipment")},2e3)):($("#container").animate({scrollTop:0},300),$("p.feedback","#edit_pass").removeClass("success, notify").addClass("error").html(e.message).show())}})})});