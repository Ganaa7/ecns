function check_date(e){var a=new Date(current_date()),t=(e=new Date(e),e-a),s=Math.ceil(t/864e5);return s}function current_date(){var e=new Date,a=e.getDate(),t=e.getMonth()+1,s=e.getFullYear();return a<10&&(a="0"+a),t<10&&(t="0"+t),s+"-"+t+"-"+a}function set_type(){var e="";return e=":Бүгд;Алтай:Алтай;Арвайхээр:Арвайхээр;Баруун-Туруун:Баруун-Туруун;Баруун-Урт:Баруун-Урт;Баянхонгор:Баянхонгор;Булган - Булган:Булган-Булган;Булган - Ховд:Булган-Ховд;Далан:Далан;Даланзадгад:Даланзадгад;Өлгий:Өлгий;Өндөрхаан:Өндөрхаан;Мандалговь:Мандалговь;Мөрөн:Мөрөн;Тосонцэнгэл:Тосонцэнгэл;Улаанбаатар:Улаанбаатар;Улаангом:Улаангом;Улиастай:Улиастай;Ургамал:Ургамал;Хархорин:Хархорин;Ховд:Ховд;Чойбалсан:Чойбалсан",e}function init_view(e){window.location.href=base_url+"/training/index/page/"+e}function init_edit(e){window.open(base_url+"/training/trainer/index/edit/"+e,"_blank")}function _delete(e){var a={id:e},t=$("#grid").getRowData(e);window.confirm("Та '"+t.fullname+"' ИТА-ын бүртгэлийг устгахдаа итгэлтэй байна уу?")&&$.ajax({type:"POST",url:base_url+"/training/index/delete/",data:a,dataType:"json",success:function(e){"success"==e.status&&(showMessage(e.message,"success"),$("#grid").trigger("reloadGrid"))}})}function _print(e){$("#grid").getRowData(e);window.open(base_url+"/training/index/print_lc?id="+e,"_blank")}function showMessage(e,a){$("p#notification").length||$("#nav-bar").prepend('<p id="notification"></p>');var t=$("p#notification");t.hide(),t.removeClass(),t.addClass(a),t.html(e),t.fadeIn("fast",function(){t.delay(3e3).fadeOut()})}function add_history(){create.dialog({buttons:{"Хадгалах":function(){var e=$("#create").serialize();$.ajax({type:"POST",url:base_url+"/training/index/add_pos_his",data:e,dataType:"json",async:!1,success:function(e){"success"==e.status?(create.dialog("close"),showMessage(e.message,"success"),location.reload()):$("p.feedback",create).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){create.dialog("close")}}}),create.dialog("open")}function add_info(){info.dialog({buttons:{"Хадгалах":function(){var e=$("#info").serialize();$.ajax({type:"POST",url:base_url+"/training/index/add_info",data:e,dataType:"json",async:!1,success:function(e){"success"==e.status?(info.dialog("close"),showMessage(e.message,"success"),location.reload()):$("p.feedback",info).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){info.dialog("close")}}}),info.dialog("open")}function outservice(e){if(1!=confirm(' Энэ мэдээллийг "Архивлахдаа" итгэлтэй байна уу?'))return 0;$.ajax({type:"POST",url:base_url+"/training/index/outservice/"+e,data:{id:e},dataType:"json",success:function(e){e.success?showMessage(e.message,"success"):showMessage(e.message,"error"),reload()}})}$(function(){$("#tabs").tabs(),sel_str=set_type(),jQuery("#grid").jqGrid({url:base_url+"/training/index/grid",datatype:"json",mtype:"GET",height:"500",width:"1260",colNames:["#","Үнэмлэх #","Байршил","Нэр.Овог","Төрөл","Мэргэжил","Олгосон /t","Хүчинтэй /t","Ажиллах төхөөрөмж","Утас","Имэйл"],colModel:[{name:"trainer_id",index:"trainer_id",search:!1,width:30},{name:"license_no",index:"license_no",width:60,align:"center",searchoptions:{sopt:["cn"]}},{name:"location",index:"location",width:80,align:"right",stype:"select",searchoptions:{value:sel_str}},{name:"fullname",index:"fullname",width:90,align:"right",searchoptions:{sopt:["cn"]}},{name:"license_type",index:"license_type",width:80,align:"right",searchoptions:{sopt:["cn"]}},{name:"occupation",index:"occupation",width:80,align:"right",searchoptions:{sopt:["cn"]}},{name:"issued_date",index:"issued_date",width:60,align:"center",searchoptions:{dataInit:function(e){$(e).datepicker({dateFormat:"yy-mm-dd"}).change(function(){$("#grid")[0].triggerToolbar()})},sopt:["cn"]}},{name:"valid_date",index:"valid_date",width:60,align:"center",searchoptions:{dataInit:function(e){$(e).datepicker({dateFormat:"yy-mm-dd"}).change(function(){$("#grid")[0].triggerToolbar()})}}},{name:"license_equipment",index:"license_equipment",width:80,searchoptions:{sopt:["cn"]}},{name:"phone",index:"phone",width:80,searchoptions:{sopt:["cn"]}},{name:"email",index:"email",width:80,searchoptions:{sopt:["cn"]}}],jsonReader:{page:"page",total:"total",records:"records",root:"rows",repeatitems:!1,id:"trainer_id"},rowNum:20,rowList:[10,20,30],pager:"#pager",sortname:"trainer_id",viewrecords:!0,sortorder:"asc",caption:"ИТА мэдээлэл",loadComplete:function(){for(var e=$(this).jqGrid("getDataIDs"),a=0;a<e.length;a++){var t=$("#grid").jqGrid("getRowData",e[a]),s=jQuery("#"+e[a],jQuery("#grid"));(check_date(t.valid_date)<=30||!t.valid_date.length||"0000-00-00"==t.valid_date)&&(s.removeClass("ui-widget-content"),s.addClass("argent")),check_date(t.valid_date)>30&&check_date(t.valid_date)<=60&&t.valid_date.length>0&&(s.removeClass("ui-widget-content"),s.addClass("warning")),s.addClass("context-menu")}}}),jQuery("#grid").jqGrid("filterToolbar",{stringResult:!0,searchOnEnter:!0}),jQuery("#outgrid").jqGrid({url:base_url+"/training/index/out_grid",datatype:"json",mtype:"GET",height:"500",width:"1260",colNames:["#","Үнэмлэх #","Байршил","Нэр.Овог","Төрөл","Мэргэжил","Олгосон /t","Хүчинтэй /t","Ажиллах төхөөрөмж","Утас","Имэйл"],colModel:[{name:"trainer_id",index:"trainer_id",search:!1,width:30},{name:"license_no",index:"license_no",width:60,align:"center",searchoptions:{sopt:["cn"]}},{name:"location",index:"location",width:80,align:"right",stype:"select",searchoptions:{value:sel_str}},{name:"fullname",index:"fullname",width:90,align:"right",searchoptions:{sopt:["cn"]}},{name:"license_type",index:"license_type",width:80,align:"right",searchoptions:{sopt:["cn"]}},{name:"occupation",index:"occupation",width:80,align:"right",searchoptions:{sopt:["cn"]}},{name:"issued_date",index:"issued_date",width:60,align:"center",searchoptions:{dataInit:function(e){$(e).datepicker({dateFormat:"yy-mm-dd"}).change(function(){$("#grid")[0].triggerToolbar()})},sopt:["cn"]}},{name:"valid_date",index:"valid_date",width:60,align:"center",searchoptions:{dataInit:function(e){$(e).datepicker({dateFormat:"yy-mm-dd"}).change(function(){$("#grid")[0].triggerToolbar()})}}},{name:"license_equipment",index:"license_equipment",width:80,searchoptions:{sopt:["cn"]}},{name:"phone",index:"phone",width:80,searchoptions:{sopt:["cn"]}},{name:"email",index:"email",width:80,searchoptions:{sopt:["cn"]}}],jsonReader:{page:"page",total:"total",records:"records",root:"rows",repeatitems:!1,id:"trainer_id"},rowNum:20,rowList:[10,20,30],pager:"#pager",sortname:"trainer_id",viewrecords:!0,sortorder:"asc",caption:"ИТА мэдээлэл"}),jQuery("#outgrid").jqGrid("filterToolbar",{stringResult:!0,searchOnEnter:!0}),$("#edu_button_add").click(function(){var e="<tr><td><input type='datetime' name='school[]'></td><td><input type='datetime' name='enter_dt[]' class='date_class'></td><td><input type='text' name='grade_dt[]' class='date_class'></td><td><textarea name='detail[]' cols='25'></textarea></td></tr>";$("#education").append(e).find(".date_class").datepicker()}),$("#edu_button_sub").click(function(){var e=$("#education tr").length;e>2?$("#education tr:last").remove():alert("Сүүлчийн мөрийг хасах боломжгүй!")}),$("#back").click(function(){document.location=base_url+"/training/"}),$("#valid_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0,opened:!1}),$("#issued_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0,opened:!1}),$(".enter_dt").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0,opened:!1}),$(".year_dt").datepicker({dateFormat:"yy,mm,dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0,opened:!1}),$("#submit").click(function(){var e=$("#trainer_form"),a={};$('input[type="text"], input[type="hidden"], select, textarea',e),a=$(e).serialize();$.ajax({type:"POST",url:base_url+"/training/index/update/",data:a,dataType:"json",success:function(a){"success"==a.status?($("p.feedback",e).removeClass("error").hide(),showMessage(a.message,"success"),document.location=base_url+"/training/"):$("p.feedback",e).removeClass("success, notify").addClass("error").html(a.message).show()}})}),$(".btnDelete").on("click",function(e){e.stopPropagation(),e.stopImmediatePropagation();var a=$(this).attr("id");$.ajax({type:"POST",url:base_url+"/training/index/del_pos_his",data:{id:a},dataType:"json",async:!1,success:function(e){"success"==e.status?(create.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)):$("p.feedback",create).removeClass("success, notify").addClass("error").html(e.message).show()}})}),$(".exam_history_add").click(function(){form_exam.dialog({buttons:{"Хадгалах":function(){var e=$("#exam").serialize();$.ajax({type:"POST",url:base_url+"/training/index/add_exam_his",data:e,dataType:"json",async:!1,success:function(e){"success"==e.status?(form_exam.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)):$("p.feedback",form_exam).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){form_exam.dialog("close")}}}),form_exam.dialog("open")}),$(".deleteExam").on("click",function(e){e.stopPropagation(),e.stopImmediatePropagation();var a=$(this).attr("id");$.ajax({type:"POST",url:base_url+"/training/index/del_exam_his",data:{id:a},dataType:"json",async:!1,success:function(e){"success"==e.status?(form_exam.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)):$("p.feedback",create).removeClass("success, notify").addClass("error").html(e.message).show()}})}),$(".deleteRemark").on("click",function(e){e.stopPropagation(),e.stopImmediatePropagation();var a=$(this).attr("id");$.ajax({type:"POST",url:base_url+"/training/index/del_remark",data:{id:a},dataType:"json",async:!1,success:function(e){"success"==e.status?(form_exam.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)):$("p.feedback",create).removeClass("success, notify").addClass("error").html(e.message).show()}})}),$("#special_mark").click(function(){remark_dialog.dialog({buttons:{"Хадгалах":function(){var e=$("#remark").serialize();$.ajax({type:"POST",url:base_url+"/training/index/add_remark",data:e,dataType:"json",async:!1,success:function(e){"success"==e.status?(form_exam.dialog("close"),showMessage(e.message,"success"),setTimeout(function(){location.reload()},1e3)):$("p.feedback",remark_dialog).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){remark_dialog.dialog("close")}}}),remark_dialog.dialog("open")})});