function jqgrid(){$("#grid").jqGrid({url:base_url+"/wh_spare/spare/index/grid",datatype:"json",mtype:"GET",colNames:["№","Хэсэг","Төхөөрөмж","Сэлбэг","Парт №","Алслагдсан/обьект үлдэгдэл","Ашиглагдаж буй тоо/ш","Сэлбэгэнд байх ёстой тоо/ш","Агуулахад","Хэмжих нэгж"],colModel:[{name:"spare_id",index:"spare_id",width:15,align:"center"},{name:"section",index:"_wh_vw_spare.section",width:50,align:"center",stype:"select",searchoptions:{value:set_section()}},{name:"equipment",index:"_wh_vw_spare.equipment",width:120},{name:"spare",index:"_wh_vw_spare.spare",width:80,align:"center"},{name:"part_number",index:"_wh_vw_spare.part_number",width:60,align:"center"},{name:"qty",index:"qty",width:50,align:"center"},{name:"using_qty",index:"using_qty",width:50,align:"center"},{name:"need_qty",index:"need_qty",width:50,align:"center"},{name:"aqty",index:"aqty",width:50,align:"center"},{name:"measure",index:"measure",width:40,align:"center"}],jsonReader:{page:"page",total:"total",records:"records",root:"rows",repeatitems:!1,id:"spare_id"},pager:"#pager",rowNum:20,rowList:[10,20,30,40,60,80,100],sortname:"_wh_vw_spare.spare_id",sortorder:"asc",viewrecords:!0,gridview:!0,caption:"Сэлбэгийн бүртгэл",autowidth:!0,height:500,width:"100%",editurl:"server.php",loadComplete:function(){for(var e=$(this).jqGrid("getDataIDs"),a=0;a<e.length;a++){var t=$("#grid").jqGrid("getRowData",e[a]),s=jQuery("#"+e[a],jQuery("#grid"));s.addClass("context-menu1"),parseInt(t.need_qty)>parseInt(t.aqty)&&(s.removeClass("ui-widget-content"),s.addClass("argent"))}},subGridRowExpanded:function(e,a){var t;t="_"+e,jQuery("#"+e).html("<table id='"+t+"' class='scroll'></table>"),jQuery("#"+t).jqGrid({autoencode:!1,url:base_url+"/wh_spare/spare/index/sub_grid?id="+a,datatype:"xml",colNames:["id","#","Байршил","Тоо/ш","Баркод","Сериал"],colModel:[{name:"id",index:"id",width:0,key:!0,hidden:!0},{name:"i",index:"i",width:35,key:!0,align:"center"},{name:"site",index:"site",width:200,align:"center"},{name:"qty",index:"qty",width:50,key:!0,align:"center"},{name:"barcode",index:"barcode",width:150,align:"center"},{name:"serial",index:"serial",width:100,align:"center"}],height:"100%",width:"100%",rowNum:20,sortname:"num",sortorder:"asc",loadComplete:function(){for(var e=$(this).jqGrid("getDataIDs"),a=0;a<e.length;a++){var t=jQuery("#"+e[a],jQuery("#grid"));$(this).jqGrid("getRowData",e[a]),t=jQuery("#"+e[a],jQuery("#grid"));t.addClass("context-menu"),$(this).expandSubGridRow(e[a])}}})}}).navGrid("#pager",{edit:!1,add:!1,del:!1,search:!0}),jQuery("#grid").jqGrid("filterToolbar",{searchOperators:!0,stringResult:!0,defaultSearch:"cn"})}function set_section(){var e="",a=0;return $("#section_id option").each(function(){e=$(this).text()+":"+$(this).text(),a++}),console.log("count"+a),e=":Бүгд;Холбоо:Холбоо;Навигаци:Навигаци;Ажиглалт:Ажиглалт;Гэрэл суулт, цахилгаан:ГСЦ;ЧОУНБХ (NUBIA):ЧОУНБХ (NUBIA)",e}function add_modal(e,a){$("#spare",add).val(a),$("input[name=spare_id]",add).val(e),add.dialog({buttons:{"Хадгалах":function(){var e=$("#create").serialize();$.ajax({type:"POST",url:base_url+"/wh_spare/spare/index/add",data:e,dataType:"json",async:!1,success:function(e){"success"==e.status?(add.dialog("close"),showMessage(e.message,"success"),jQuery("#grid").jqGrid("setGridParam",{datatype:"json"}).trigger("reloadGrid")):$("p.feedback",add).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){add.dialog("close")}}}),add.dialog("open")}function use_modal(e,a,t){$("#spare",use).val(a),$("#using_qty",use).val(t),$("input[name=spare_id]",use).val(e),use.dialog({buttons:{"Хадгалах":function(){var e=use.serialize();$.ajax({type:"POST",url:base_url+"/wh_spare/spare/index/use",data:e,dataType:"json",async:!1,success:function(e){"success"==e.status?(use.dialog("close"),showMessage(e.message,"success"),jQuery("#grid").jqGrid("setGridParam",{datatype:"json"}).trigger("reloadGrid")):$("p.feedback",use).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){use.dialog("close")}}}),use.dialog("open")}function need_modal(e,a,t){$("#spare",need).val(a),$("#need_qty",need).val(t),$("input[name=spare_id]",need).val(e),need.dialog({buttons:{"Хадгалах":function(){var e=need.serialize();$.ajax({type:"POST",url:base_url+"/wh_spare/spare/index/need",data:e,dataType:"json",async:!1,success:function(e){"success"==e.status?(need.dialog("close"),showMessage(e.message,"success"),jQuery("#grid").jqGrid("setGridParam",{datatype:"json"}).trigger("reloadGrid")):$("p.feedback",need).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){need.dialog("close")}}}),need.dialog("open")}function help_modal(){$("#dialog").dialog({buttons:{"Хаах":function(){$(this).dialog("close")}}}),$("#dialog").dialog("open")}var add,minus,rest;$(function(){$(document).tooltip(),$("#dialog").dialog({autoOpen:!1,width:600,resizable:!1,modal:!0,close:function(){$(this).dialog("close")}}),$("#add_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0,opened:!1}),$("#using_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0,opened:!1}),$("#need_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0,opened:!1}),jqgrid(),add=$("#create"),add.dialog({autoOpen:!1,width:860,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"], input[type="hidden"], select, textarea',$(this)).val(""),$(".route",$(this)).remove(),$(this).dialog("close"),$(".last_tr").length&&$(".last_tr").remove()}}),use=$("#using"),use.dialog({autoOpen:!1,width:560,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"], input[type="hidden"], select, textarea',$(this)).val(""),$(".route",$(this)).remove(),$(this).dialog("close")}}),need=$("#need"),need.dialog({autoOpen:!1,width:560,resizable:!1,modal:!0,close:function(){$("p.feedback",$(this)).html("").hide(),$('input[type="text"], input[type="hidden"], select, textarea',$(this)).val(""),$(".route",$(this)).remove(),$(this).dialog("close")}}),$("#add_spare").on("click",function(){add.dialog({buttons:{"Хадгалах":function(){var e=$("#create").serialize();$.ajax({type:"POST",url:base_url+"/wh_spare/spare/index/add",data:e,dataType:"json",async:!1,success:function(e){"success"==e.status?(add.dialog("close"),showMessage(e.message,"success"),jQuery("#grid").jqGrid("setGridParam",{datatype:"json"}).trigger("reloadGrid")):$("p.feedback",add).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Хаах":function(){add.dialog("close")}}}),add.dialog("open")}),$("#add_site").on("click",function(){$("#site_wrapper","#create").append('<tr class="last_tr"><td class="last_row"></td><td><input type="text" name="serial[]"/></td><td><input type="text" name="barcode[]"/></td></tr>');var e=$("#site option").clone();$newSelect=$('<select name="site_id[]"></select>').append(e),$(".last_row").append($newSelect),$("td").removeClass("last_row")}),$(document).on("click",".remove_site",function(){$("tr:last").remove()}),$("#qty","#create").keyup(function(){var e=$(this).val();$(".last_tr").length&&$(".last_tr").remove();for(var a=e;a>1;a--){$("#site_wrapper","#create").append('<tr class="last_tr"><td id="row_'+a+'"></td><td><input type="text" name="serial[]"/></td><td><input type="text" name="barcode[]"/></td></tr>');var t=$("#site option").clone();$newSelect=$('<select name="site_id[]"></select>').append(t),$("#row_"+a).append($newSelect)}})});