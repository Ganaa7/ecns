function remove_it(e,t){var a=$("#count").val();$("#count").val(a-1),$("#row_"+e).remove(),$(".dtl_id_"+e).remove()}function get_expense_dtl(e,t,a){if(null!==e){var i;if(""===e)return void(document.getElementById(a).innerHTML="");if(i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&(i.responseText?(document.getElementById(a).innerHTML=i.responseText,s=1):$("p.feedback","#spare_dialog").addClass("error").html("Агуулахад ["+t+"] сэлбэг дууссан байна! Үлдэгдэл = 0!").show())},"qty_wrap_edit"==a)var s="edit",o=$("#invoice_id").val();else s="none";i.open("GET",base_url+"/wh_spare/get_exp_dtl?spare_id="+e+"&invoice_id="+o,!0),i.send()}else alert("Сэлбэг сонгогдоогүй байна! Сэлбэгийг сонгоно уу?")}function checkit(e){count=$("#qty").val(),!0===e.checked?++count:count--,document.getElementById("qty").value=count}function check_it_edit(e){count=$("#qty","#spare_edit_dialog").val(),!0===e.checked?++count:count--,$("#qty","#spare_edit_dialog").val(count)}function showMessage(e,t){$("p#notification").length||$("#nav-bar").prepend('<p id="notification"></p>');var a=$("p#notification");a.hide(),a.removeClass(),a.addClass(t),a.html(e),a.fadeIn("fast",function(){a.delay(3e3).fadeOut()})}function edit_it(e,t,a){$.ajax({type:"POST",url:base_url+"/wh_spare/index/jx_check_edit/",data:{spare_id:t,invoice_id:a},dataType:"json",success:function(a){"success"==a.status?$.ajax({type:"POST",url:base_url+"/wh_spare/index/get/",data:{id:t,field:"end_qty"},dataType:"json",success:function(a){"success"==a.status?($("#cnt","#spare_edit_dialog").val(e),$("#measure_txt",spare_edit_dialog).text(a.spare.measure),$("#txt_section","#spare_edit_dialog").text(a.spare.section),$("#txt_sector","#spare_edit_dialog").text(a.spare.sector),$("#txt_equipment","#spare_edit_dialog").text(a.spare.equipment),$("#manufacture_id","#spare_edit_dialog").val(a.spare.manufacture_id),$("#spare_type_txt","#spare_edit_dialog").text(a.spare.sparetype),$("#part_number_txt","#spare_edit_dialog").text(a.spare.part_number),$("#spare_txt","#spare_edit_dialog").text(a.spare.spare),$("#spare_id",spare_edit_dialog).val(a.spare.spare_id),get_expense_dtl(t,$("#spare_txt","#spare_edit_dialog").text(),"qty_wrap_edit"),spare_edit_dialog.dialog("open")):alert(spare+" алдаатай байна! Дахин оролдоно уу!")}}):showMessage(a.message,"error")}}),$("#edit_income_btn").attr("disabled",!0)}$(function(){spare_dialog=$("#spare_dialog"),spare_dialog.dialog({autoOpen:!1,width:580,resizable:!1,modal:!0,close:function(){$("p.feedback",spare_dialog).html("").hide(),$('input[type="text"], input[type="hidden"], select, textarea',spare_dialog).val(""),$(this).dialog("close"),$("#qty_wrap",spare_dialog).html("")}}),spare_edit_dialog=$("#spare_edit_dialog"),spare_edit_dialog.dialog({autoOpen:!1,width:580,resizable:!1,modal:!0,close:function(){$("p.feedback",spare_edit_dialog).html("").hide(),$('input[type="text"], input[type="hidden"], select, textarea',spare_edit_dialog).val(""),$(this).dialog("close"),$("#qty_wrap_edit",spare_edit_dialog).html("")}}),$("#section_id").on("change",function(e,t){$.post(base_url+"/wh_spare/index/get_equipby_id",{id:$(this).val(),flag:"yes"},function(e){var t=$("#equipment_id");if(t.prop)a=t.prop("options");else var a=t.attr("options");$("option",t).remove(),$.each(e,function(e,t){a[a.length]=new Option(t,e)})}),$.post(base_url+"/wh_spare/index/get_section_id",{id:$(this).val(),flag:"no"},function(e){var t=$("#sector_id");if(t.prop)a=t.prop("options");else var a=t.attr("options");$("option",t).remove(),$.each(e,function(e,t){a[a.length]=new Option(t,e)})})}),$("#sector_id").on("change",function(e,t){var a=$("#section_id").val();$.post(base_url+"/wh_spare/index/get_equipby_id",{id:$(this).val(),section_id:a,flag:"no"},function(e){var t=$("#equipment_id");if(t.prop)a=t.prop("options");else var a=t.attr("options");$("option",t).remove(),$.each(e,function(e,t){a[a.length]=new Option(t,e)})})}),$("#equipment_id").on("change",function(){var e=$("#section_id").val(),t=$("#sector_id").val();$.post(base_url+"/wh_spare/index/get_spare_id",{id:$(this).val(),section_id:e,sector_id:t},function(e){var t=$("#spare_id");if(t.prop)a=t.prop("options");else var a=t.attr("options");$("option",t).remove(),$.each(e,function(e,t){a[a.length]=new Option(t,e)}),$("#spare_id").trigger("chosen:updated")})}),$("#section_id","#expense_form").on("change",function(e,t){$.post(base_url+"/wh_spare/index/get_section_id",{id:$(this).val(),flag:"no"},function(e){var t=$("#sector_id","#expense_form");if(t.prop)a=t.prop("options");else var a=t.attr("options");$("option",t).remove(),$.each(e,function(e,t){a[a.length]=new Option(t,e)})})}),$(".chosen-select").chosen();var e,t;e=$("#spare_id"),t=$("#qty",spare_dialog);var a=0;spare_dialog.dialog("option","title","Зарлага гаргах сэлбэг"),spare_dialog.dialog({buttons:{"Зарлагад нэмэх":function(){var s={};$('input[type="text"], input[type="hidden"], select, textarea',"#form_supplier").each(function(){var e=$(this);s[e.attr("name")]=e.val()}),$("input[name='spare_id[]'").each(function(){var e=$(this);$("#spare_id").val()==e.val()&&(a=1)});var o=$("#invoice_id");if(0==a)if(0==e.val()||null==e.val())alert("Нэг сэлбэг сонгоно уу?");else if(0==t.val()||null==t.val()||"number"!=typeof t.val()&&t.val()%1!=0)alert("Тоо хэмжээг оруулна уу? Бүхэл тоогоор оруулна уу!"),t.focus();else{$("#count").val()>0?i=$("#count").val():i=0,i++,$("#count").val(i),inputStr="<input type='hidden' id='spare_id_"+i+"' name='spare_id[]' value='"+e.val()+"'>",inputStr+="<input type='hidden' id='qty_"+i+"' name='qty[]' value='"+t.val()+"'>",appent_txt="<tr id=row_"+e.val()+"><td>"+i+"</td><td>"+$("#spare_txt").text()+" Парт дугаар:"+$("#part_number_txt").text()+"</td><td>"+$("#amt",spare_dialog).val()+"</td><td>"+t.val()+$("#measure_txt").text()+"</td><td>"+Math.floor($("#amt",spare_dialog).val()*t.val())+" ₮ <a class='remove_it' data-id='857' href='#' onclick='remove_it("+e.val()+","+o.val()+")'> (Хасах) </a> </td></tr>"+inputStr,$("#expense_table").append(appent_txt);var r=1;$.each($("input[name='spare_pk[]']:checked","#spare_dialog"),function(){$("#expense_form").append('<input type="hidden" class="dtl_id_'+e.val()+'" name="dtl_id['+e.val()+"]["+r+']" value="'+$(this).val()+'" />'),r++}),$("#remove_tr","#expense_form").hide(),$(this).dialog("close")}else a=0,alert("["+$("#spare_txt").text()+"] сэлбэгийг аль хэдийн жагсаалтад нэмсэн тул дахин нэмэх боломжгүй!")},"Цуцлах":function(){spare_dialog.dialog("close"),$("#qty_wrap>span","#spare_dialog").remove()}}}),spare_edit_dialog.dialog("option","title","Зарлага гаргах сэлбэг"),spare_edit_dialog.dialog({buttons:{"Зарлага засах":function(){var e={},t=$('input[type="text"], input[type="hidden"], select, textarea',"#form_supplier"),a=$("#spare_id","#spare_edit_dialog"),i=$("#qty","#spare_edit_dialog"),s=$("#amt","#spare_edit_dialog");t.each(function(){var t=$(this);e[t.attr("name")]=t.val()}),console.log("qty"+i.val());$("#invoice_id");var o=1,r=$("#cnt","#spare_edit_dialog").val();$("#spare_qty_txt_"+r).text(i.val()),$("#spare_qty_total_"+r).text(i.val()*s.val()),$("#qty_"+r).val(i.val()),$("#expense_form .dtl_id_"+a.val()).remove(),$.each($("input[name='spare_pk[]']:checked","#spare_edit_dialog"),function(){$("#expense_form").append('<input type="hidden" class="dtl_id_'+a.val()+'" name="dtl_id['+a.val()+"]["+o+']" value="'+$(this).val()+'" />'),o++}),$(this).dialog("close")},"Цуцлах":function(){spare_edit_dialog.dialog("close"),$("#qty_wrap_edit>span","#spare_edit_dialog").remove()}}}),$(".chosen-select").chosen(),$(".chosen-select","#expense_spare_form").on("change",function(e,t){var a=$("#spare_id").chosen().val(),i=$("#spare_id").chosen().text();$.ajax({type:"POST",url:base_url+"/wh_spare/index/get/",data:{id:a,field:"end_qty"},dataType:"json",success:function(e){"success"==e.status?($("#part_number").val(e.spare.part_number),$("#type").val(e.spare.sparetype),$("#type_id").val(e.spare.sparetype_id),$("#amt").val(""),$("#qty").val(""),$("#measure_txt",spare_dialog).text(e.spare.measure),$("#txt_section","#spare_dialog").text(e.spare.section),$("#txt_sector","#spare_dialog").text(e.spare.sector),$("#txt_equipment","#spare_dialog").text(e.spare.equipment),$("#manufacture_id","#spare_dialog").val(e.spare.manufacture_id),$("#spare_type_txt","#spare_dialog").text(e.spare.sparetype),$("#part_number_txt","#spare_dialog").text(e.spare.part_number),$("#spare_txt","#spare_dialog").text(e.spare.spare),$("#spare_id",spare_dialog).val(e.spare.spare_id),get_expense_dtl(a,$("#spare_txt","#spare_dialog").text(),"qty_wrap"),spare_dialog.dialog("open")):alert(i+" алдаатай байна! Дахин оролдоно уу!")}})}),$("#expense_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0});var s=0;$("#qty",spare_dialog).keyup(function(e){var t,a=0,i=$("input:checkbox",spare_dialog),o=$("#qty",spare_dialog).val(),r=1;if(s++,i.prop("checked",!1),t=i.length,o<=t){for(r=1;r<=o;r++)$("#check_"+r).attr("checked",!0),console.log("value"+Math.floor($("#amt_"+r).val())),a+=Math.floor($("#amt_"+r).val());$("#amt",spare_dialog).val(Math.floor(a/o))}else alert("Үлдэгдэл хүрэлцэхгүй байна. Зарлагын тоо хэмжээ Агуулахын тооноос их байх ёсгүй!")}).keydown(function(e){13==e.which&&e.preventDefault()}),$("#qty",spare_edit_dialog).keyup(function(e){var t,a=0,i=$("input:checkbox",spare_edit_dialog),o=$("#qty",spare_edit_dialog).val(),r=1;if(s++,i.prop("checked",!1),t=i.length,o<=t){for(r=1;r<=o;r++)$("#check_"+r).attr("checked",!0),console.log("value"+Math.floor($("#amt_"+r).val())),a+=Math.floor($("#amt_"+r).val());$("#amt",spare_edit_dialog).val(Math.floor(a/o))}else alert("Үлдэгдэл хүрэлцэхгүй байна. Зарлагын тоо хэмжээ Агуулахын тооноос их байх ёсгүй!")}).keydown(function(e){13==e.which&&e.preventDefault()}),$("#submit_btn","#expense_form").click(function(){var e={},t=$('input[type="text"], input[type="hidden"], select, textarea',"#expense_form");$("p.feedback","#expense_form").removeClass("success, notify, error").html("").hide();e=$("#expense_form").serialize();t.each(function(){var t=$(this);e[t.attr("name")]=t.val()}),$.ajax({type:"POST",url:base_url+"/wh_spare/index/jx_edit_expense/",data:e,dataType:"json",success:function(e){"success"==e.status?(showMessage(e.message,"success"),window.location=base_url+"/wh_spare/index/expense"):$("p.feedback","#expense_form").removeClass("success, notify").addClass("error").html(e.message).show()}})})});