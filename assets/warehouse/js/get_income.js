function new_spare(){console.log("here is loading"+$("#_id_equipment").val()),$("#txt_section").text($("#_id_section :selected").text()),$("#txt_sector").text($("#_id_sector :selected").text()),$("#txt_equipment").text($("#_id_equipment :selected").text()),$("#section_id","#add_spare_form").val($("#_id_section").val()),$("#sector_id","#add_spare_form").val($("#_id_sector").val()),$("#equipment_id","#add_spare_form").val($("#_id_equipment").val()),$("#dialog").dialog("option","title","Шинэ сэлбэг бүртгэх"),$("#dialog").dialog({buttons:{"Хадгалах":function(){var e={};$('input[type="text"], input[type="hidden"], select, textarea',"#add_spare_form").each(function(){var t=$(this);e[t.attr("name")]=t.val()}),$.ajax({type:"POST",url:base_url+"/wh_spare/index/jx_add_spare/",data:e,dataType:"json",success:function(e){"success"==e.status?(showMessage(e.message,"success"),$("#spare_id").append('<option value="'+e.spare_id+'">'+e.spare+"</option>"),$("#spare_id").trigger("chosen:updated"),$("#dialog").dialog("close")):showMessage(e.message,"error")}})},"Цуцлах":function(){$("#dialog").dialog("close")}}}),$("#dialog").dialog("open")}$(function(){$("#spare_form").validate({errorLabelContainer:"#feedback",wrapper:"li",rules:{section_id:"required",sector_id:"required",equipment_id:"required",spare_id:"required",type:"required",part_number:"required",amt:{required:!0},qty:{required:!0,number:!0}},messages:{section_id:"Хэсгийг сонгоно уу!",sector_id:"Тасгийг сонгоно уу!",equipment_id:"Төхөөрөмжийг сонгоно уу!",spare_id:"Сэлбэгээс сонгоно уу!",type:"Төрөл утга шаардлагатай",part_number:"Парт № утга шаардлагатай",amt:"Үнэ утга өгөх шаардлагатай",qty:"Тоо утга өгөх шаардлагатай"},errorPlacement:function(e,t){e.insertAfter(t.parent())}}),$("#income_form").validate({rules:{income_no:"required",income_date:"required",supplier_id:"required",count:{required:!0,minlength:1}},messages:{income_no:"Орлогийн дугаар оруулна уу!",income_date:"Орлогийн огноо оруулна уу!",supplier_id:"Нийлүүлэгчийг сонгоно уу!",count:{required:"Сэлбэгээс сонгож орлогийн жагсаалтад оруулна уу!"}}}),open=$("#add_dialog"),open.dialog({autoOpen:!1,width:550,resizable:!1,modal:!0,close:function(){$("p.feedback",open).html("").hide(),$('input[type="text"], input[type="hidden"], select, textarea',open).val(""),$(this).dialog("close")}}),$(".chosen-select").chosen(),$(".chosen-select-deselect").chosen(),$("#amt").maskMoney({thousands:",",decimal:".",allowZero:!0,suffix:" ₮"}),$("#income_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showOtherMonths:!0,showWeek:!0});var e=$("#income_form");$("#spare_id",e);$("#count").val(0),$(".chosen-select","#spare_form").on("change",function(e,t){var i=$("#spare_id").chosen().val();$.ajax({type:"POST",url:base_url+"/wh_spare/index/get/",data:{id:i,target:"equipment"},dataType:"json",success:function(e){"success"==e.status&&($("#part_number").val(e.spare.part_number),$("#type").val(e.spare.sparetype),$("#type_id").val(e.spare.sparetype_id),$("#amt").val(""),$("#qty").val(""),$("#measure").val(e.spare.measure))}})}),$("#_id_section").on("change",function(e,t){$.post(base_url+"/wh_spare/index/get_equipby_id",{id:$(this).val(),flag:"yes"},function(e){var t=$("#_id_equipment");if(t.prop)i=t.prop("options");else var i=t.attr("options");$("option",t).remove(),$.each(e,function(e,t){i[i.length]=new Option(t,e)})}),$.post(base_url+"/wh_spare/index/get_section_id",{id:$(this).val(),flag:"no"},function(e){var t=$("#_id_sector");if(t.prop)i=t.prop("options");else var i=t.attr("options");$("option",t).remove(),$.each(e,function(e,t){i[i.length]=new Option(t,e)})})}),$("#_id_sector").on("change",function(e,t){var i=$("#_id_section").val();$.post(base_url+"/wh_spare/index/get_equipby_id",{id:$(this).val(),section_id:i,flag:"no"},function(e){var t=$("#_id_equipment");if(t.prop)i=t.prop("options");else var i=t.attr("options");$("option",t).remove(),$.each(e,function(e,t){i[i.length]=new Option(t,e)})})});var t=[],a="";$("#add_btn").mousedown(function(){var e=$("#spare_id").chosen().val(),n=$("#spare_id_chosen .chosen-single").text(),s=$("#qty"),o=$("#amt").maskMoney("unmasked")[0],r=$("#type_id"),d=$("#part_number"),p=$("#measure"),l=$("#_id_equipment"),u=($("#_id_section"),$("#_id_sector")),l=$("#_id_equipment");t.indexOf("'"+n+"'");if("-1"!=t.indexOf(n))alert(n+"-г орлогийн жагсаалтад нэмэгдсэн тул дахин жагсаалтад нэмэх боломжгүй!");else if($("#spare_form").valid()){t.push(n),$("#remove_tr").remove(),$("#count").val()>0?i=$("#count").val():i=0,i++,$("#count").val(i);var c;c=o*s.val(),inputStr="<input type='hidden' id='spare_id_"+i+"' name='spare_id' value='"+e+"'>",inputStr+="<input type='hidden' id='qty_"+i+"' name='qty[]' value='"+s.val()+"'>",inputStr+="<input type='hidden' id='amt_"+i+"' name='amt[]' value='"+o+"'>",inputStr+="<input type='hidden' id='type_"+i+"' name='type_id[]' value='"+r.val()+"'>",inputStr+="<input type='hidden' id='spare["+i+"]' name='spare["+i+"][name]' value='"+n+"'>",inputStr+="<input type='hidden' id='spare["+i+"]' name='spare["+i+"][id]' value='"+e+"'>",inputStr+="<input type='hidden' id='order["+i+"]' name='spare["+i+"][order]' value='"+i+"'>",inputStr+="<input type='hidden' id='equpment["+i+"]' name='spare["+i+"][equipment_id]' value='"+l.val()+"'>",inputStr+="<input type='hidden' id='sector_id["+i+"]' name='spare["+i+"][sector_id]' value='"+u.val()+"'>",inputStr+="<input type='hidden' id='type_id["+i+"]' name='spare["+i+"][type_id]' value='"+r.val()+"'>",inputStr+="<input type='hidden' id='qty["+i+"]' name='spare["+i+"][qty]' value='"+s.val()+"'>",inputStr+="<input type='hidden' id='amt["+i+"]' name='spare["+i+"][amt]' value='"+o+"'>",a="<tr id="+i+"><td>"+i+"</td><td><strong>"+n+"</strong>. <b>P/N: </b><i>"+d.val()+"</i></td><td>"+o+"</td><td>"+s.val()+" "+p.val()+"</td><td>"+c.toFixed(2)+"<a class='remove_it' data-id='"+e+"' href='#'> (Хасах) </a></td></tr>"+inputStr,$("#spare_id").trigger("chosen:updated")}}).mouseup(function(){a.length&&($("#income_table").append(a),$(".chosen-select").val("").trigger("chosen:updated"),$("#qty").val(""),$("#amt").val(""),$("#type_id").val(""),$("#part_number").val(""),$("#measure").val(""))}),$("#_id_equipment").on("change",function(){var e=$("#_id_section").val(),t=$("#_id_sector").val();$.post(base_url+"/wh_spare/index/get_spare_id",{id:$(this).val(),section_id:e,sector_id:t},function(e){var t=$("#spare_id");if(t.prop)i=t.prop("options");else var i=t.attr("options");$("option",t).remove(),$.each(e,function(e,t){i[i.length]=new Option(t,e)}),$("#spare_id").trigger("chosen:updated")})}),$("#dialog").dialog({width:600,resizable:!1,modal:!0,autoOpen:!1,close:function(){$('input[type="text"], input[type="hidden"], select, textarea',$(this)).val(""),$("#txt_section").text(""),$("#txt_sector").text(""),$("#txt_equipment").text(""),$(this).dialog("close")}}),$("#form_supplier").dialog({width:580,resizable:!1,modal:!0,autoOpen:!1,close:function(){$('input[type="text"], input[type="hidden"], select, textarea',$(this)).val(""),$(this).dialog("close"),$("p.feedback",$(this)).html("").hide()}}),$("#spare_id").change(function(){-1==$(this).val()&&new_spare()}),$("#supplier_id").change(function(){-1==$(this).val()&&($("#form_supplier").dialog("option","title","Нийлүүлэгч шинээр бүртгэх"),$("#form_supplier").dialog({buttons:{"Хадгалах":function(){var e={};$('input[type="text"], input[type="hidden"], select, textarea',"#form_supplier").each(function(){var t=$(this);e[t.attr("name")]=t.val()}),$.ajax({type:"POST",url:base_url+"/wh_spare/index/jx_add_supplier/",data:e,dataType:"json",success:function(e){"success"==e.status?(showMessage(e.message,"success"),$("#supplier_id").append('<option value="'+e.supplier_id+'">'+e.supplier+"</option>"),$("#supplier_id").trigger("chosen:updated"),$("#form_supplier").dialog("close")):$("p.feedback","#form_supplier").removeClass("success, notify").addClass("error").html(e.message).show()}})},"Цуцлах":function(){$("#form_supplier").dialog("close")}}}),$("#form_supplier").dialog("open"))})});var config={".chosen-select":{},".chosen-select-deselect":{allow_single_deselect:!0},".chosen-select-no-single":{disable_search_threshold:10},".chosen-select-no-results":{no_results_text:"Oops, nothing found!"},".chosen-select-width":{width:"95%"}};for(var selector in config)$(selector).chosen(config[selector]);