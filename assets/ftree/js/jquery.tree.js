function showMessage(e,t){$("p#notification").length||$("#nav-bar").prepend('<p id="notification"></p>');var i=$("p#notification");i.hide(),i.removeClass(),i.addClass(t),i.html(e),i.fadeIn("fast",function(){i.delay(3e3).fadeOut()})}function _d_event(){console.log("event called"),eventForm.dialog("option","title","Event үүсгэх"),eventForm.dialog({buttons:{"Хадгалах":function(){$("p.feedback",eventForm).removeClass("success, error").addClass("notify").html("Утгуудыг сервер руу илгээж байна...").show();var e={};$('input[type="text"], input[type="hidden"], select, textarea',eventForm).each(function(){var t=$(this);e[t.attr("name")]=t.val()}),e.closed_datetime>e.created_datetime?e.duration_time=1:e.duration_time=0,$.ajax({type:"POST",url:base_url+"/ftree/index/event",data:e,dataType:"json",success:function(e){"success"==e.status?(eventForm.dialog("close"),showMessage(e.message,"success")):$("p.feedback",eventForm).removeClass("success, notify").addClass("error").html(e.message).show()}})},"Цуцлах":function(){eventForm.dialog("close")}}}),eventForm.dialog("open")}!function(e){e.fn.tree_structure=function(t){var i={add_option:!0,edit_option:!0,delete_option:!0,confirm_before_delete:!0,animate_option:[!0,5],fullwidth_option:!1,align_option:"center",draggable_option:!0};return this.each(function(){function s(e){e.prepend(g+_).children("div").prepend(b+x+C),console.log("parent:"),0==e.children("ul").length||e.parent().hasClass("tree")?e.parent().hasClass("tree")&&(e.hasClass("thide")?e.children("div").prepend('<b class="thide tshow"></b>'):e.children("div").prepend('<b class="thide"></b>')):(e.hasClass("thide"),e.children("div").prepend('<b class="thide tshow"></b>')),e.children("div").prepend(w)}function l(t){var i=e("."+k).offset().left;i=parseInt(i,10);var s=t.children("div").outerWidth(!0)/2,l=t.children("div").offset().left;if(null!=t.parents("li").offset())var a=t.parents("li").offset().top;if(vertical_height=t.offset().top-a-t.parents("li").children("div").outerHeight(!0)/2,t.children("span.vertical").css({height:vertical_height,"margin-top":-vertical_height,"margin-left":s,left:l-i}),null==t.parents("li").offset())n=0;else var n=t.parents("li").children("div").offset().left+t.parents("li").children("div").width()/2-(l+t.children("div").width()/2);var d=n<0?-Math.abs(n)+s:s;t.children("span.horizontal").css({width:Math.abs(n),"margin-top":-vertical_height,"margin-left":d,left:l-i})}function a(){e("."+k+" li").each(function(){"pageload"==y&&s(e(this)),l(e(this))})}function n(e){if(e.length>0)return e.children("div").addClass("parent"),e=e.closest("li").closest("ul").closest("li"),n(e)}function d(){o(),e("."+k+" li > div").draggable({cursor:"move",distance:40,zIndex:5,revert:!0,revertDuration:100,snap:".tree li div",snapMode:"inner",start:function(t,i){e("li.li_children").removeClass("li_children"),e(this).closest("li").addClass("li_children")},stop:function(e,t){o()}})}function o(){e("."+k+" li > div").droppable({accept:".tree li div",drop:function(t,i){if(e("div.check_div").removeClass("check_div"),e(".li_children div").addClass("check_div"),e(this).hasClass("check_div"))alert(" Энэ мөчир рүү зөөж чадсангүй!");else{var s="action=drag&id="+e(i.draggable[0]).attr("id")+"&parentid="+e(this).attr("id");e.ajax({type:"POST",url:base_url+"/ftree/index/drag_node",data:s,success:function(e){e.status,alert(e.message),location.reload()}}),0==e(this).next("ul").length?e(this).after("<ul><li>"+e(i.draggable[0]).attr({style:""}).closest("li").html()+"</li></ul>"):e(this).next("ul").append("<li>"+e(i.draggable[0]).attr({style:""}).closest("li").html()+"</li>"),1==e(i.draggable[0]).closest("ul").children("li").length?e(i.draggable[0]).closest("ul").remove():e(i.draggable[0]).closest("li").remove(),a(),d()}}})}t&&e.extend(i,t);var c=i.add_option,r=i.edit_option,h=i.delete_option,f=i.confirm_before_delete,v=i.animate_option,p=i.fullwidth_option,u=i.align_option,m=i.draggable_option,g='<span class="vertical"></span>',_='<span class="horizontal"></span>',b=1==c?'<span class="add_action" title="Нэмэх! "></span>':"",C=1==r?'<span class="edit_action" title="Засах!"></span>':"",x=1==h?'<span class="delete_action" title="Устгах!"></span>':"",w='<span class="highlight" title=" Сонгох | dblClick"></span>',k=e(this).attr("class"),y="pageload";if("center"!=u&&e("."+k+" li").css({"text-align":u}),p){var j,z,$=0;e("."+k+" li li").each(function(){var t=e(this).width();(0==$||t>j)&&(j=e(this).width(),z=e(this)),$++});var O=z.closest("ul").children("li").eq(0).nextAll().length,F=parseInt(0);for($i=0;$i<=O;$i++)F+=parseInt(z.closest("ul").children("li").eq($i).width());e("."+k).closest("div").width(F)}if(e("."+k+" li>ul>li").each(function(){e(this).children("ul").hide()}),e("."+k+" li.thide").each(function(){e(this).children("ul").hide()}),1==v[0])var S=e("."+k+" li").length,$=0;v[0]?$timeout=setInterval(function(){s(e("."+k+" li").eq($)),l(e("."+k+" li").eq($)),++$==S&&($=0,clearInterval($timeout))},v[1]):a(),y="others",e(window).resize(function(){a()}),e(document).on("click","."+k+" b.thide",function(){e(this).toggleClass("tshow"),e(this).closest("li").toggleClass("thide").children("ul").toggle(),a()}),e(document).on("hover","."+k+" li > div",function(t){"mouseenter"==t.type||"mouseover"==t.type?(e("."+k+" li > div.current").removeClass("current"),e("."+k+" li > div.children").removeClass("children"),e("."+k+" li > div.parent").removeClass("parent"),e(this).addClass("current"),e(this).closest("li").children("ul").children("li").children("div").addClass("children"),e(this).closest("li").closest("ul").closest("li").children("div").addClass("parent"),e(this).children("span.highlight, span.add_action, span.delete_action, span.edit_action").show()):e(this).children("span.highlight, span.add_action, span.delete_action, span.edit_action").hide()}),e(document).on("click","."+k+" span.highlight",function(){e("."+k+" li.highlight").removeClass("highlight"),e("."+k+" li > div.parent").removeClass("parent"),e("."+k+" li > div.children").removeClass("children"),e(this).closest("li").addClass("highlight"),e(".highlight li > div").addClass("children");n(e(this).closest("li").closest("ul").closest("li"))}),e(document).on("click","."+k+" span.highlight",function(){p&&e("."+k).parent("div").parent("div").scrollLeft(0),e("."+k+" li > div").not(".parent, .current, .children").closest("li").addClass("tnone"),e("."+k+" li div b.thide.tshow").closest("div").closest("li").children("ul").addClass("tshow"),e("."+k+" li div b.thide").addClass("tnone"),0==e(".back_btn").length&&e("body #container .overflow").prepend('<img src="'+base_url+'/assets/ftree/images/back.png" class="back_btn" />'),a(),e(".back_btn").click(function(){e("."+k+" ul.tshow").removeClass("tshow"),e("."+k+" li.tnone").removeClass("tnone"),e("."+k+" li div b.thide").removeClass("tnone"),e(this).remove(),a()})}),c&&e(document).on("click","."+k+" span.add_action",function(){e("form.add_data").length>0&&e("form.add_data").remove(),e("form.edit_data").length>0&&e("form.edit_data").remove();var t=e(this);if(t.closest("div").hasClass("undevelop"))alert('"Тодорхой бус" төрөлтэй мөчир дээр энэ үйлдэл боломжгүй!');else{t.closest("div").removeClass("basic");e.ajax({type:"POST",url:base_url+"/ftree/ajax",data:"action=addform",success:function(i){var s=i;0==t.closest("div").children("form.add_data").length&&(t.parent("div").append(s),t.closest("div").children("form").offset().top+t.closest("div").children("form").outerHeight()>e(window).height()&&t.closest("div").children("form").css({"margin-top":-t.closest("div").children("form").outerHeight()}),t.closest("div").children("form").offset().left+t.closest("div").children("form").outerWidth()>e(window).width()&&t.closest("div").children("form").css({"margin-left":-t.closest("div").children("form").outerWidth()}),t.closest("div").children("form").children("input.first_name").focus(),t.closest("div").closest("li").closest("ul").children("li").children("div").addClass("zindex"))}}),e(document).on("click","input.submit",function(t){var i,s=e(this);t.preventDefault();var l="action=add&ftree_id="+s.closest("div").attr("id")+"&";l+=s.closest("form").serialize(),s.closest("li").before("<img src='"+base_url+"/assets/ftree/images/load.gif' class='load' />"),e.ajax({type:"POST",url:base_url+"/ftree/index/add_node",data:l,success:function(t){if("success"==t.status){e(document).off("click","input.submit");var l="<li>"+g+_+'<div class="basic" id="'+(i=t)+'">'+w+b+x+C+"<span class='first_name'>"+s.closest("form").find("input.first_name").val()+" "+s.closest("form").find("select.event option:selected").text()+"</span></div></li>";console.log("html"+l),s.closest("li").children("ul").length>0?s.closest("li").children("ul").append(l):s.closest("li").append("<ul>"+l+"</ul>"),s.closest("form.add_data").closest("div").children("span.highlight, span.add_action, span.delete_action, span.edit_action").hide(),s.closest("form.add_data").remove(),e("li > div.zindex").removeClass("zindex"),a(),d(),e("img.load").remove(),location.reload()}else s.closest("form.add_data").append("<span style='color:red'>"+t.message+"</span>")}})}),e(document).on("click","img.close",function(){e(this).closest("form.add_data").closest("div").children("span.highlight, span.add_action, span.delete_action, span.edit_action").hide(),e(this).closest("form.add_data").remove(),e("li > div.zindex").removeClass("zindex")})}}),r&&e(document).on("click","."+k+" span.edit_action",function(){e("form.add_data").length>0&&e("form.add_data").remove(),e("form.edit_data").length>0&&e("form.edit_data").remove();var t=e(this).closest("div").clone();t.children("span.highlight").length>0&&t.children("span.highlight").remove(),t.children("span.delete_action").length>0&&t.children("span.delete_action").remove(),t.children("span.add_action").length>0&&t.children("span.add_action").remove(),t.children("span.edit_action").length>0&&t.children("span.edit_action").remove(),t.children("b.thide").length>0&&t.children("b.thide").remove();e(this).closest("li").hasClass("thide");var i=e(this).closest("div").attr("id"),s=e(this),l="action=editform&edit_ele_id="+i;e.ajax({type:"POST",url:base_url+"/ftree/edit_node",data:l,success:function(t){var i=t;0==s.closest("div").children("form.edit_data").length&&(s.closest("div").append(i),s.closest("div").children("form").offset().top+s.closest("div").children("form").outerHeight()>e(window).height()&&s.closest("div").children("form").css({"margin-top":-s.closest("div").children("form").outerHeight()}),s.closest("div").children("form").offset().left+s.closest("div").children("form").outerWidth()>e(window).width()&&s.closest("div").children("form").css({"margin-left":-s.closest("div").children("form").outerWidth()}),s.closest("div").children("form").children("input.first_name").focus().select(),s.closest("div").children("form").children("option.event").focus().select(),s.closest("div").closest("li").closest("ul").children("li").children("div").addClass("zindex"))}}),e(document).on("click","input.edit",function(t){var i=e(this);t.preventDefault();var s="action=edit&id="+i.closest("div").attr("id")+"&";s+=i.closest("form").serialize(),i.closest("li").before("<img src='"+base_url+"/assets/ftree/images/load.gif' class='load' />"),e.ajax({type:"POST",url:base_url+"/ftree/index/edit_node",data:s,success:function(t){if("success"==t.status){e(document).off("click","input.edit"),i.closest("form").find("input:checked").length>0?0==i.closest("li").hasClass("thide")&&i.closest("div").find("b.thide").trigger("click"):i.closest("li").hasClass("thide")&&i.closest("div").find("b.thide").trigger("click");var s=i.closest("form.edit_data").closest("div"),l="";l+="<span class='first_name'>"+i.closest("form").find("input.first_name").val()+" "+i.closest("form").find("select.event option:selected").text()+"</span>",s.children("span.edit_action").nextAll().remove(),s.text().length>0&&s.html(s.html().replace(s.text(),"")),s.append(l),s.children("span.highlight, span.add_action, span.delete_action, span.edit_action").hide(),e("li > div.zindex").removeClass("zindex"),a(),e("img.load").remove(),alert(t.message),location.reload()}else i.closest("form.edit_data").prepend("<span style='color:red'>"+t.message+"</span>")}})}),e(document).on("click","img.close",function(){e(this).closest("form.edit_data").closest("div").children("span.highlight, span.add_action, span.delete_action, span.edit_action").hide(),e(this).closest("form.edit_data").remove(),e("li > div.zindex").removeClass("zindex")})}),h&&e(document).on("click","."+k+" span.delete_action",function(){var t=e(this),i=e(this).closest("li").closest("ul").closest("li");if(confirm_message=1,f){console.log("confirm checked");var s=0===e(this).closest("li").children("ul").length?"Энэ мөчрийг устгахдаа итгэлтэй байна уу ?":"Үүнийг бүх мөчирүүдийн хамт \n устгахдаа итгэлтэй байна уу?";confirm_message=confirm(s)}if(1==e(this).closest("div").attr("id"))alert("You cant delete root person");else if(confirm_message){e(this).closest("li").addClass("ajax_delete_all"),ajax_delete_id=Array(),ajax_delete_id.push(e(this).closest("div").attr("id")),e(".ajax_delete_all li").each(function(){ajax_delete_id.push(e(this).children("div").attr("id"))}),e(this).closest("li").removeClass("ajax_delete_all");var l="action=delete&id="+ajax_delete_id;e(this).closest("li").before("<img src='"+base_url+"/assets/ftree/images/load.gif' class='load' />"),e.ajax({type:"POST",url:base_url+"/ftree/index/delete_node",data:l,success:function(s){"success"==s.status?(e("img.load").remove(),t.closest("li").fadeOut().remove(),a(),0==i.children("ul").children("li").length&&i.children("ul").remove(),alert(s.message),location.reload()):(alert(s.message),location.reload())}})}}),m&&(e("."+k+" li > div").disableSelection(),d())})}}(jQuery);